"use strict";var _createClass=function(){function a(b,f){for(var h,g=0;g<f.length;g++)h=f[g],h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(b,h.key,h)}return function(b,f,g){return f&&a(b.prototype,f),g&&a(b,g),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var __decorate=function(a,b,f,g){var l,h=arguments.length,j=3>h?b:null===g?g=Object.getOwnPropertyDescriptor(b,f):g;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)j=Reflect.decorate(a,b,f,g);else for(var m=a.length-1;0<=m;m--)(l=a[m])&&(j=(3>h?l(j):3<h?l(b,f,j):l(b,f))||j);return 3<h&&j&&Object.defineProperty(b,f,j),j},__metadata=function(a,b){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=function(a,b,f,g){return new(f||(f=Promise))(function(h,j){function l(o){try{n(g.next(o))}catch(p){j(p)}}function m(o){try{n(g["throw"](o))}catch(p){j(p)}}function n(o){o.done?h(o.value):new f(function(p){p(o.value)}).then(l,m)}n((g=g.apply(a,b)).next())})},core_1=require("@angular/core"),content_1=require("ui/content"),admin_client_1=require("admin/admin.client"),account_client_1=require("admin/account.client"),errisy_ui_1=require("errisy-ui"),management_client_1=require("management/management.client"),AccountAdminComponent=function(){function a(b,f,g,h,j){var l=this;_classCallCheck(this,a),this.changeDetectorRef=b,this.parent=f,this.admin=g,this.account=h,this.manage=j,this.style_flex="1 1 auto",this.style_display="flex",this.Tabs=[{Title:"User Accounts",Tab:[{Title:"Users",View:[[errisy_ui_1.fields.text("_id","ID").readonly(),errisy_ui_1.fields.text("name","Name")],[errisy_ui_1.fields.text("mobile","Mobile"),errisy_ui_1.fields.checkbox("active","Active")],[errisy_ui_1.fields.text("Company","Company")],[errisy_ui_1.fields.text("email","Email")],errisy_ui_1.rows.text(errisy_ui_1.fields.textarea("BillingAddress","Billing Address")),[errisy_ui_1.fields.checkbox("valid","Is Account Valid")],errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Save").event("click",this,function(){return __awaiter(l,void 0,void 0,regeneratorRuntime.mark(function m(){return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.parent.Status="Trying to update selected item...",o.prev=1,o.next=4,this.account.update(this.tab.data.SelectedItem);case 4:this.parent.Status="Updated.",o.next=10;break;case 7:o.prev=7,o.t0=o["catch"](1),this.parent.Status=o.t0;case 10:case"end":return o.stop();}},m,this,[[1,7]])}))}))]}],CanCreate:!1,CanDelete:!1,Source:function(){return l.account},Fields:"_id",DataTemplateUrl:{Value:"<div class=\"flex-row-stretch flex-stretch list-item\" [class.checked]=\"Selected\" [class.selected-items]=\"MultipleSelected\" (click)=\"Parent.SelectItem(Item, $event);\"> {{Item._id}} ({{Item.Name}}) </div>"}},{Title:"Verify",Tab:[{Title:"Verify Shop",View:[errisy_ui_1.rows.custom("200px",errisy_ui_1.fields.textarea("Value","Input Code").event("ngModelChange",this,function(m){return __awaiter(l,void 0,void 0,regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:console.log("value changed:",m),o=this.tab.Entity,/Shop\s+Type\s*\:\s*(\w+)/ig.test(m)&&(o.Shop=/Shop\s+Type\s*\:\s*(\w+)/ig.exec(m)[1]),/Shop\s+ID\s*\:\s*(\w+)/ig.test(m)&&(o.ID=/Shop\s+ID\s*\:\s*(\w+)/ig.exec(m)[1]),/Verification\s+Code\s*\:\s*(\w+)/ig.test(m)&&(o.Code=/Verification\s+Code\s*\:\s*(\w+)/ig.exec(m)[1]);case 5:case"end":return q.stop();}},n,this)}))})),[errisy_ui_1.fields.text("Shop","Shop Type")],[errisy_ui_1.fields.text("ID","Shop ID")],[errisy_ui_1.fields.text("Code","Code")],errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Activate").event("click",this,function(){return __awaiter(l,void 0,void 0,regeneratorRuntime.mark(function m(){var n,o;return regeneratorRuntime.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:n=this.tab.Entity,this.parent.Status="Verifying Shop...",o=this.account.verifyShop(n.Shop,n.ID,n.Code),this.parent.Status=o?"Shop Verification Success!":"Shop Verification Failed.";case 4:case"end":return q.stop();}},m,this)}))}))]}],Entity:function(){return __awaiter(l,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",{});case 1:case"end":return p.stop();}},n,this)}))}},{Title:"Payment",Tab:[{Title:"Payment by Reference",View:[[errisy_ui_1.fields.text("Reference","Reference").verify(errisy_ui_1.verifictions.required)],errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Execute").event("click",this,function(){return __awaiter(l,void 0,void 0,regeneratorRuntime.mark(function m(){var n,o;return regeneratorRuntime.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return this.parent.Status="Executing payment...",n=this.tab.Entity,q.next=4,this.manage.ReceiveOfflinePayment(n.Reference);case 4:o=q.sent,this.parent.Status=o?"Paid":"Failed";case 6:case"end":return q.stop();}},m,this)}))}))]}],Entity:function(){return __awaiter(l,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",{});case 1:case"end":return p.stop();}},n,this)}))}}]}return _createClass(a,[{key:"ngAfterContentInit",value:function(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function f(){return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.parent.checkLogin();case 2:if(h.sent){h.next=5;break}return this.parent.select(0),h.abrupt("return");case 5:this.parent.Title="Accouts",this.changeDetectorRef.detectChanges();case 7:case"end":return h.stop();}},f,this)}))}}]),a}();__decorate([core_1.HostBinding("style.flex"),__metadata("design:type",String)],AccountAdminComponent.prototype,"style_flex",void 0),__decorate([core_1.HostBinding("style.display"),__metadata("design:type",String)],AccountAdminComponent.prototype,"style_display",void 0),__decorate([core_1.ViewChild("tab"),__metadata("design:type",errisy_ui_1.TabManager)],AccountAdminComponent.prototype,"tab",void 0),AccountAdminComponent=__decorate([core_1.Component({selector:"admin-developer",template:" <div class=\"flex-column-stretch flex-stretch\"> <div class=\"flex-row-stretch view-title\"> <div class=\"flex-row-center flex-stretch flex-center\"> <span style=\"cursor: default; user-select: none\">{{parent.Title}}</span> </div> </div> <div [TabManager]=\"Tabs\" #tab class=\"flex-column-stretch flex-stretch warm-gradient\"> </div> <div class=\"flex-row-center view-status\"> {{parent.Status}} </div> </div>",entryComponents:[],providers:[admin_client_1.AdminCore,account_client_1.AccountCore,management_client_1.ManageCore],changeDetection:core_1.ChangeDetectionStrategy.Default}),__metadata("design:paramtypes",[core_1.ChangeDetectorRef,content_1.ContentControl,admin_client_1.AdminCore,account_client_1.AccountCore,management_client_1.ManageCore])],AccountAdminComponent),exports.AccountAdminComponent=AccountAdminComponent;