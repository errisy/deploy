"use strict";var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var __awaiter=function(a,b,c,d){return new(c||(c=Promise))(function(f,g){function h(l){try{k(d.next(l))}catch(m){g(m)}}function j(l){try{k(d["throw"](l))}catch(m){g(m)}}function k(l){l.done?f(l.value):new c(function(m){m(l.value)}).then(h,j)}k((d=d.apply(a,b)).next())})},Folder=function a(b){_classCallCheck(this,a),this.name=b,this.files=[]};exports.Folder=Folder;var UserArchive=function a(b){_classCallCheck(this,a),this.name=b,this.folders=[]};exports.UserArchive=UserArchive;var StockCenterListItem=function(){function a(b,c,d,f,g,h){_classCallCheck(this,a),this.stockCenter=b,this.mcds=c,this.stockService=d,this.username=f,this.password=g,this.expanded=h,this.isActive=!1}return _createClass(a,[{key:"tryConnect",value:function(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function c(){var d,f;return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:d=0;case 1:if(!(d<this.stockCenter.URLs.length)){h.next=17;break}return h.prev=2,f=this.stockCenter.URLs[d],this.stockService.$baseURL=f.URL,h.next=7,this.stockService.test();case 7:if(!h.sent){h.next=10;break}return this.isActive=!0,h.abrupt("return",!0);case 10:h.next=14;break;case 12:h.prev=12,h.t0=h["catch"](2);case 14:d++,h.next=1;break;case 17:return h.abrupt("return",!1);case 18:case"end":return h.stop();}},c,this,[[2,12]])}))}},{key:"getFiles",value:function(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function c(){var d,f,g,h,j,k,l,m;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(j=function(q,r){h[q]||(h[q]={});var s=h[q];return s[r]||(s[r]=new Folder(r)),s[r]},this.tryConnect()){o.next=4;break}return console.warn("Failed in connecting to stock server <"+this.stockCenter.Name+">"),o.abrupt("return");case 4:return o.next=6,this.stockService.createToken(this.username);case 6:if(d=o.sent,f=void 0,!(-1<this.stockCenter.Managers.indexOf(this.username))){o.next=14;break}return o.next=11,this.mcds.endorseManagerForStockCenter(this.username,this.password,this.stockCenter._id,d);case 11:f=o.sent,o.next=18;break;case 14:if(!(-1<this.stockCenter.Members.indexOf(this.username))){o.next=18;break}return o.next=17,this.mcds.endorseUserForStockCenter(this.username,this.password,this.stockCenter._id,d);case 17:f=o.sent;case 18:return o.next=20,this.stockService.checkToken(this.username,f);case 20:return this.code=o.sent,o.next=23,this.stockService.getStockCenter(this.username,this.code,this.stockCenter._id);case 23:return this.stockCenterInfo=o.sent,this.expanded=!0,o.next=27,this.stockService.getFilesForUser(this.username,this.code);case 27:for(k in g=o.sent,h={},h[this.username]={},h[this.username]["<No Tag>"]=new Folder("<No Tag>"),g.forEach(function(p){p.folders&&0<p.folders.length?p.folders.forEach(function(q){j(p.owner,q).files.push(p)}):j(p.owner,"<No Tag>").files.push(p)}),this.users=[],h){for(m in l=new UserArchive(k),h[k])l.folders.push(h[k][m]);this.users.push(l)}console.log("expanded: ",this.expanded);case 35:case"end":return o.stop();}},c,this)}))}},{key:"saveFileToStockCenter",value:function(c,d,f){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function g(){return regeneratorRuntime.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return f.owner=this.username,j.next=3,this.stockService.saveFile(this.username,this.code,f);case 3:case"end":return j.stop();}},g,this)}))}},{key:"readFile",value:function(c){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function d(){return regeneratorRuntime.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.stockService.readFile(this.username,this.code,c);case 2:return g.abrupt("return",g.sent);case 3:case"end":return g.stop();}},d,this)}))}}]),a}();exports.StockCenterListItem=StockCenterListItem;