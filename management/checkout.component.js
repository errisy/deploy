"use strict";var _createClass=function(){function a(b,f){for(var h,g=0;g<f.length;g++)h=f[g],h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(b,h.key,h)}return function(b,f,g){return f&&a(b.prototype,f),g&&a(b,g),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var __decorate=function(a,b,f,g){var l,h=arguments.length,j=3>h?b:null===g?g=Object.getOwnPropertyDescriptor(b,f):g;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)j=Reflect.decorate(a,b,f,g);else for(var m=a.length-1;0<=m;m--)(l=a[m])&&(j=(3>h?l(j):3<h?l(b,f,j):l(b,f))||j);return 3<h&&j&&Object.defineProperty(b,f,j),j},__metadata=function(a,b){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=function(a,b,f,g){return new(f||(f=Promise))(function(h,j){function l(o){try{n(g.next(o))}catch(p){j(p)}}function m(o){try{n(g["throw"](o))}catch(p){j(p)}}function n(o){o.done?h(o.value):new f(function(p){p(o.value)}).then(l,m)}n((g=g.apply(a,b)).next())})},core_1=require("@angular/core"),content_1=require("ui/content"),shop_data_1=require("shop/shop.data"),management_client_1=require("management/management.client"),errisy_ui_1=require("errisy-ui"),payment_data_1=require("shop/payment.data"),ShopType=shop_data_1.FastFoodShop,ProductType=shop_data_1.FastFoodProduct,CategoryType=shop_data_1.FastFoodCategory,EntryType=shop_data_1.FastFoodEntry,CheckoutComponent=function(){function a(b,f,g,h){var j=this;_classCallCheck(this,a),this.manage=b,this.orders=f,this.parent=g,this.changeDetectorRef=h,this.style_flex="1 1 auto",this.style_display="flex",this.Tabs=[{Title:"Shopping Cart",Tab:[{Title:"Orders to Confirm",View:[[errisy_ui_1.fields.text(function(){return payment_data_1.ShoppingCart.prototype.Subtotal},"Subtotal (in Australia Dollar)").readonly()],errisy_ui_1.rows.auto(errisy_ui_1.fields.listview(function(){return payment_data_1.ShoppingCart.prototype.Items},{Value:"<div class=\"flex-row-stretch flex-stretch list-item\" [class.checked]=\"Parent.SelectedItem==Item\" [class.selected-items]=\"MultipleSelected\" (click)=\"Parent.SelectItem(Item, $event);\"> <div class=\"flex-column-stretch flex-stretch checkout-item\"> <div class=\"flex-row-stretch flex-stretch\"> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Service Type:</span> <span class=\"value\">{{Item.ServiceType}}</span> </div> </div> <div class=\"flex-row-stretch flex-stretch\"> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Reference ID:</span> <span class=\"value\">{{Item.ReferenceID}}</span> </div> </div> <div class=\"flex-row-stretch flex-stretch\"> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Price:</span> <span class=\"value\">${{Item.Price}}/Unit</span> </div> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Unit:</span> <span class=\"value\">{{Item.Unit}} Day{{Item.Unit>1?'s':''}}</span> </div> </div> <div class=\"flex-row-stretch flex-stretch\"> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Quantity:</span> <span class=\"value\">{{Item.Quantity}}</span> </div> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Subtotal:</span> <span class=\"value\">${{Item.Subtotal}}</span> </div> </div> </div> <svg class=\"svg-btn-remove\" viewBox=\"0 0 32 32\" (click)=\"Parent.Remove(Index)\"> <line x1=\"4\" x2=\"28\" y1=\"4\" y2=\"28\" stroke-width=\"4\" stroke=\"black\"/> <line x1=\"4\" x2=\"28\" y1=\"28\" y2=\"4\" stroke-width=\"4\" stroke=\"black\"/> </svg> </div>"},"Items in Your Shopping Cart:",360,400).event("ngModelChange",this,function(){return __awaiter(j,void 0,void 0,regeneratorRuntime.mark(function l(){var m;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:m=this.tab.Entity,m.Subtotal=m.Items.map(function(p){return p.Subtotal}).reduce(function(p,q){return p+q},0);case 2:case"end":return o.stop();}},l,this)}))})),errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Save").event("click",this,function(){return __awaiter(j,void 0,void 0,regeneratorRuntime.mark(function l(){var m;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return m=this.tab.Entity,o.next=3,this.manage.saveShoppingCart(m);case 3:this.tab.Entity=o.sent;case 4:case"end":return o.stop();}},l,this)}))})),errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Checkout Now").event("click",this,function(){return __awaiter(j,void 0,void 0,regeneratorRuntime.mark(function l(){var m,n;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return m=this.tab.Entity,p.next=3,this.manage.saveShoppingCart(m);case 3:return this.tab.Entity=p.sent,p.next=6,this.manage.CheckoutShoppingCart();case 6:if(n=p.sent,!n){p.next=10;break}return p.next=10,this.tab.SelectTab(this.Tabs[1],n);case 10:case"end":return p.stop();}},l,this)}))}))]}],Entity:function(){return __awaiter(j,void 0,void 0,regeneratorRuntime.mark(function m(){return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.manage.getShoppingCart());case 1:case"end":return o.stop();}},m,this)}))}},{Title:"Checkout Order",Tab:[{Title:"Payment Information",View:[errisy_ui_1.rows.custom("208px",errisy_ui_1.fields.presenter("BankInfo",{Value:"<table class=\"bank-info\"> <tbody *ngIf=\"Item\"> <tr> <td class=\"desc\">Amount Payable</td> <td class=\"refer\">${{Item.BankTransferAmount}}</td> </tr> <tr> <td class=\"desc\">BSB</td> <td class=\"value\">{{Item.BankTransferBSB}}</td> </tr> <tr> <td class=\"desc\">Account Number</td> <td class=\"value\">{{Item.BankTransferAccount}}</td> </tr> <tr> <td class=\"desc\">Account Name</td> <td class=\"value\">{{Item.BankTransferName}}</td> </tr> <tr> <td class=\"desc\">Reference Code for Transaction</td> <td class=\"refer\">{{Item.BankTransferReference}}</td> </tr> <tr> <td class=\"info\" colspan=\"2\"> <div style=\"text-wrap: normal; width: 500px\"> Please make sure that you put the reference code above during the bank transfer (in the reference or description box). Otherwise, we may have difficulty in confirming your payment. </div> </td> </tr> </tbody> </table>"},"Bank Transfer (Take A few Days)")),errisy_ui_1.rows.custom("205px",errisy_ui_1.fields.presenter("PaypalInfo",{Value:"<table class=\"bank-info\"> <tbody *ngIf=\"Item\"> <tr> <td class=\"info\" colspan=\"2\"> <div style=\"text-wrap: normal; width: 500px\"> Paypal charges 2.6% surcharge plus $0.3 transaction fee. That's why the Paypal amount is higher than the bank transfer amount. </div> </td> </tr> <tr> <td class=\"desc\">Amount Payable</td> <td class=\"refer\">${{Item.PaypalAmount}}</td> </tr> <tr> <td class=\"desc\">Paypal Payment Link</td> <td class=\"value\"><a [href]=\"Item.PaypalURL\" [target]=\"Item.PaypalTarget\">Click to Pay via Paypal</a></td> </tr> <tr> <td class=\"info\" colspan=\"2\"> <div style=\"text-wrap: normal; width: 500px\"> By clicking the link above, you will be navigated to Paypal website and complete the payment via either Paypal credit or cards. </div> </td> </tr> <tr> <td class=\"info\" colspan=\"2\"> <div style=\"text-wrap: normal; width: 500px\"> In case paypal session is expired, click the button below to renew Paypal link. </div> </td> </tr> </tbody> </table>"},"Pay via Paypal (Immediate Activation)"))]}],Condition:function(){return __awaiter(j,void 0,void 0,regeneratorRuntime.mark(function m(){return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop();}},m,this)}))}},{Title:"Order History",Tab:[{Title:"Details",View:[[errisy_ui_1.fields.text(function(){return payment_data_1.ServiceOrder.prototype.Subtotal},"Subtotal (in Australia Dollar)").readonly()],[errisy_ui_1.fields.datetime(function(){return payment_data_1.ServiceOrder.prototype.OrderDate},"Order Date").readonly()],errisy_ui_1.rows.auto(errisy_ui_1.fields.listview(function(){return payment_data_1.ServiceOrder.prototype.Items},{Value:"<div class=\"flex-row-stretch flex-stretch list-item\" [class.checked]=\"Parent.SelectedItem==Item\" [class.selected-items]=\"MultipleSelected\" (click)=\"Parent.SelectItem(Item, $event);\"> <div class=\"flex-column-stretch flex-stretch checkout-item\"> <div class=\"flex-row-stretch flex-stretch\"> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Service Type:</span> <span class=\"value\">{{Item.ServiceType}}</span> </div> </div> <div class=\"flex-row-stretch flex-stretch\"> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Reference ID:</span> <span class=\"value\">{{Item.ReferenceID}}</span> </div> </div> <div class=\"flex-row-stretch flex-stretch\"> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Price:</span> <span class=\"value\">${{Item.Price}}/Unit</span> </div> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Unit:</span> <span class=\"value\">{{Item.Unit}} Day{{Item.Unit>1?'s':''}}</span> </div> </div> <div class=\"flex-row-stretch flex-stretch\"> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Quantity:</span> <span class=\"value\">{{Item.Quantity}}</span> </div> <div class=\"flex-column-stretch flex-stretch\"> <span class=\"title\">Subtotal:</span> <span class=\"value\">${{Item.Subtotal}}</span> </div> </div> </div> </div>"},"Items in Your Shopping Cart:",360,400).event("ngModelChange",this,function(){return __awaiter(j,void 0,void 0,regeneratorRuntime.mark(function l(){var m;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:m=this.tab.Entity,m.Subtotal=m.Items.map(function(p){return p.Subtotal}).reduce(function(p,q){return p+q},0);case 2:case"end":return o.stop();}},l,this)}))}))]},{Title:"How to Pay",View:[errisy_ui_1.rows.custom("208px",errisy_ui_1.fields.presenter("BankInfo",{Value:"<table class=\"bank-info\"> <tbody *ngIf=\"Item\"> <tr> <td class=\"desc\">Amount Payable</td> <td class=\"refer\">${{Item.BankTransferAmount}}</td> </tr> <tr> <td class=\"desc\">BSB</td> <td class=\"value\">{{Item.BankTransferBSB}}</td> </tr> <tr> <td class=\"desc\">Account Number</td> <td class=\"value\">{{Item.BankTransferAccount}}</td> </tr> <tr> <td class=\"desc\">Account Name</td> <td class=\"value\">{{Item.BankTransferName}}</td> </tr> <tr> <td class=\"desc\">Reference Code for Transaction</td> <td class=\"refer\">{{Item.BankTransferReference}}</td> </tr> <tr> <td class=\"info\" colspan=\"2\"> <div style=\"text-wrap: normal; width: 500px\"> Please make sure that you put the reference code above during the bank transfer (in the reference or description box). Otherwise, we may have difficulty in confirming your payment. </div> </td> </tr> </tbody> </table>"},"Bank Transfer (Take A few Days)")),errisy_ui_1.rows.custom("205px",errisy_ui_1.fields.presenter("PaypalInfo",{Value:"<table class=\"bank-info\"> <tbody *ngIf=\"Item\"> <tr> <td class=\"info\" colspan=\"2\"> <div style=\"text-wrap: normal; width: 500px\"> Paypal charges 2.6% surcharge plus $0.3 transaction fee. That's why the Paypal amount is higher than the bank transfer amount. </div> </td> </tr> <tr> <td class=\"desc\">Amount Payable</td> <td class=\"refer\">${{Item.PaypalAmount}}</td> </tr> <tr> <td class=\"desc\">Paypal Payment Link</td> <td class=\"value\"><a [href]=\"Item.PaypalURL\" [target]=\"Item.PaypalTarget\">Click to Pay via Paypal</a></td> </tr> <tr> <td class=\"info\" colspan=\"2\"> <div style=\"text-wrap: normal; width: 500px\"> By clicking the link above, you will be navigated to Paypal website and complete the payment via either Paypal credit or cards. </div> </td> </tr> <tr> <td class=\"info\" colspan=\"2\"> <div style=\"text-wrap: normal; width: 500px\"> In case paypal session is expired, click the button below to renew Paypal link. </div> </td> </tr> </tbody> </table>"},"Pay via Paypal (Immediate Activation)")),errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Renew Paypal Link").event("click",this,function(){return __awaiter(j,void 0,void 0,regeneratorRuntime.mark(function l(){var m,n;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return m=this.tab.tabview.Entity,p.next=3,this.manage.RenewPaypal(m._id);case 3:if(n=p.sent,!n){p.next=7;break}return p.next=7,this.tab.SelectTab(this.Tabs[1],n);case 7:case"end":return p.stop();}},l,this)}))}))]}],Fields:"_id",DataTemplateUrl:{Value:"<div class=\"flex-row-stretch flex-stretch list-item\" [class.checked]=\"Parent.SelectedItem==Item\" [class.selected-items]=\"MultipleSelected\" (click)=\"Parent.SelectItem(Item, $event);\"> {{Item._id}} (${{Item.Subtotal}}) </div>"},Source:function(){return j.orders},CanCreate:!1,CanDelete:!0}]}return _createClass(a,[{key:"ngAfterContentInit",value:function(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function f(){return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.parent.checkLogin();case 2:if(h.sent){h.next=5;break}return this.parent.select(0),h.abrupt("return");case 5:this.parent.Title="Checkout and History",this.changeDetectorRef.detectChanges();case 7:case"end":return h.stop();}},f,this)}))}}]),a}();__decorate([core_1.ViewChild("view"),__metadata("design:type",errisy_ui_1.InfoTableControl)],CheckoutComponent.prototype,"View",void 0),__decorate([core_1.HostBinding("style.flex"),__metadata("design:type",String)],CheckoutComponent.prototype,"style_flex",void 0),__decorate([core_1.HostBinding("style.display"),__metadata("design:type",String)],CheckoutComponent.prototype,"style_display",void 0),__decorate([core_1.ViewChild("tab"),__metadata("design:type",errisy_ui_1.TabManager)],CheckoutComponent.prototype,"tab",void 0),CheckoutComponent=__decorate([core_1.Component({selector:"manage-fastfood",template:" <div class=\"flex-column-stretch flex-stretch\"> <div class=\"flex-row-stretch view-title\"> <div class=\"flex-row-center flex-stretch flex-center\"> <span style=\"cursor: default; user-select: none\">{{parent.Title}}</span> </div> </div> <div [TabManager]=\"Tabs\" #tab class=\"flex-column-stretch flex-stretch warm-gradient\"> </div> <div class=\"flex-row-center view-status\"> {{parent.Status}} </div> </div>",providers:[management_client_1.ManageCore,management_client_1.OrdersCore]}),__metadata("design:paramtypes",[management_client_1.ManageCore,management_client_1.OrdersCore,content_1.ContentControl,core_1.ChangeDetectorRef])],CheckoutComponent),exports.CheckoutComponent=CheckoutComponent;