"use strict";var __decorate=this&&this.__decorate||function(a,b,f,g){var l,h=arguments.length,j=3>h?b:null===g?g=Object.getOwnPropertyDescriptor(b,f):g;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)j=Reflect.decorate(a,b,f,g);else for(var m=a.length-1;0<=m;m--)(l=a[m])&&(j=(3>h?l(j):3<h?l(b,f,j):l(b,f))||j);return 3<h&&j&&Object.defineProperty(b,f,j),j},__metadata=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=this&&this.__awaiter||function(a,b,f,g){return new(f||(f=Promise))(function(h,j){function l(o){try{n(g.next(o))}catch(p){j(p)}}function m(o){try{n(g["throw"](o))}catch(p){j(p)}}function n(o){o.done?h(o.value):new f(function(p){p(o.value)}).then(l,m)}n((g=g.apply(a,b)).next())})};const core_1=require("@angular/core"),mcds_client_1=require("../mcds/mcds.client"),util=require("errisy-util"),errisy_bindable_1=require("errisy-bindable"),settings_1=require("../mcds/settings"),nuctions_1=require("../mcds/nuctions"),ng2_completer_1=require("ng2-completer");let DigestionBufferManagement=class{constructor(b,f,g){this.mcds=b,this.changeDetectorRef=f,this.completerService=g,this.MethylazationTypes=["Not Sensitive","Impaired by some Overlapping","Blocked by some Overlapping","Impaired when Overlapping","Blocked when Overlapping","Impaired","Blocked"]}ngAfterViewInit(){return __awaiter(this,void 0,void 0,function*(){yield this.loadDigestionBuffers(),yield this.loadRestrictionEnzymes(),this.changeDetectorRef.detectChanges()})}loadDigestionBuffers(){return __awaiter(this,void 0,void 0,function*(){this.Status="Loading...",this.changeDetectorRef.detectChanges();let b=yield this.mcds.readDigestionBuffersSetting(util.cookie.get("username"),util.cookie.get("password"));if(b&&"string"==typeof b)try{this.DigestionBuffers=yield errisy_bindable_1.obs.unpack(b),this.Status="Loaded."}catch(f){this.DigestionBuffers=new settings_1.DigestionBuffers,this.Status="Created."}else this.DigestionBuffers=new settings_1.DigestionBuffers,this.Status="Created."})}loadRestrictionEnzymes(){return __awaiter(this,void 0,void 0,function*(){this.Status="Loading Restriction Enzymes...",this.changeDetectorRef.detectChanges();let b=yield this.mcds.readRestrictionEnzymesSetting(util.cookie.get("username"),util.cookie.get("password"));if(b&&"string"==typeof b)try{let f=yield errisy_bindable_1.obs.unpack(b);this.EnzymeList=this.completerService.local(f.Enzymes.map(g=>{return{value:g.Name}}),"value","value"),this.Status="Loaded."}catch(f){this.EnzymeList=this.EnzymeList=this.completerService.local([],"value","value")}else this.EnzymeList=this.EnzymeList=this.completerService.local([],"value","value")})}Save(){return __awaiter(this,void 0,void 0,function*(){this.Status="Saving...",yield this.mcds.writeDigestionBuffersSetting(util.cookie.get("username"),util.cookie.get("password"),errisy_bindable_1.obs.pack(this.DigestionBuffers)),this.Status="Saved."})}addSystem(){let b=new nuctions_1.DigestionBufferSystem;b.Name="New System",this.DigestionBuffers.Systems.push(b)}removeSystem(b){let f=this.DigestionBuffers.Systems.indexOf(b);-1<f&&(this.DigestionBuffers.Systems.splice(f,1),this.selectedSystem==b&&this.selectSystem(void 0))}selectSystem(b){this.selectedSystem=b,this.selectAliasName(void 0)}addAliasName(){if(this.selectedSystem){let b=new nuctions_1.DigestionAliasName;b.AliasName="New Alias Name",this.selectedSystem.AliasNames.push(b)}}removeAliasName(b){if(this.selectedSystem){let f=this.selectedSystem.AliasNames.indexOf(b);-1<f&&(this.selectedSystem.AliasNames.splice(f,1),this.selectedAliasName==b&&this.selectAliasName(void 0))}}selectAliasName(b){this.selectedAliasName=b}addBufferType(){if(this.selectedSystem){let b=new nuctions_1.DigestionBufferType;b.Name="New Buffer Type",this.selectedSystem.BufferTypes.push(b)}}removeBufferType(b){if(this.selectedSystem){let f=this.selectedSystem.BufferTypes.indexOf(b);-1<f&&this.selectedSystem.BufferTypes.splice(f,1)}}addDigestionBuffer(){if(this.selectedSystem&&this.selectedAliasName){let b=new nuctions_1.DigestionBufferInfo;b.Alias=this.selectedAliasName,b.StarActivity=!1,b.Activity=100,b.Temperature=37,b.dam="Not Sensitive",b.dcm="Not Sensitive",b.CpG="Not Sensitive",this.selectedAliasName.DigestionBuffers.push(b)}}addAllDigestionBuffer(){this.selectedSystem&&this.selectedAliasName&&this.selectedSystem.BufferTypes.forEach(b=>{let f=new nuctions_1.DigestionBufferInfo;f.BufferType=b,f.Alias=this.selectedAliasName,f.StarActivity=!1,f.Activity=100,f.Temperature=37,f.dam="Not Sensitive",f.dcm="Not Sensitive",f.CpG="Not Sensitive",this.selectedAliasName.DigestionBuffers.push(f)})}removeDigestionBuffer(b){if(this.selectedAliasName){let f=this.selectedAliasName.DigestionBuffers.indexOf(b);-1<f&&(this.selectedAliasName.DigestionBuffers.splice(f,1),this.selectedDigestionBuffer==b&&this.selectDigestionBuffer(void 0))}}selectDigestionBuffer(b){this.selectedDigestionBuffer=b}};DigestionBufferManagement=__decorate([core_1.Component({selector:"digestion-buffer",templateUrl:"management/digestionbuffer.component.html",providers:[mcds_client_1.MCDSCore]}),__metadata("design:paramtypes",["function"==typeof(_a="undefined"!=typeof mcds_client_1.MCDSCore&&mcds_client_1.MCDSCore)&&_a||Object,core_1.ChangeDetectorRef,ng2_completer_1.CompleterService])],DigestionBufferManagement),exports.DigestionBufferManagement=DigestionBufferManagement;var _a;