"use strict";var __decorate=this&&this.__decorate||function(a,b,f,g){var l,h=arguments.length,j=3>h?b:null===g?g=Object.getOwnPropertyDescriptor(b,f):g;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)j=Reflect.decorate(a,b,f,g);else for(var m=a.length-1;0<=m;m--)(l=a[m])&&(j=(3>h?l(j):3<h?l(b,f,j):l(b,f))||j);return 3<h&&j&&Object.defineProperty(b,f,j),j},__metadata=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=this&&this.__awaiter||function(a,b,f,g){return new(f||(f=Promise))(function(h,j){function l(o){try{n(g.next(o))}catch(p){j(p)}}function m(o){try{n(g["throw"](o))}catch(p){j(p)}}function n(o){o.done?h(o.value):new f(function(p){p(o.value)}).then(l,m)}n((g=g.apply(a,b)).next())})};const core_1=require("@angular/core"),mcds_client_1=require("../mcds/mcds.client"),util=require("errisy-util"),errisy_bindable_1=require("errisy-bindable"),settings_1=require("../mcds/settings"),genefile_1=require("../mcds/genefile");let FeatureManagement=class{constructor(b,f){this.mcds=b,this.changeDetectorRef=f}ngAfterViewInit(){return __awaiter(this,void 0,void 0,function*(){yield this.loadFeatureTypes(),yield this.loadFeatures(),this.changeDetectorRef.detectChanges()})}loadFeatures(){return __awaiter(this,void 0,void 0,function*(){this.Status="Loading...",this.changeDetectorRef.detectChanges();let b=yield this.mcds.readFeaturesSetting(util.cookie.get("username"),util.cookie.get("password"));if(b&&"string"==typeof b)try{this.FeaturesSetting=yield errisy_bindable_1.obs.unpack(b),this.Status="Loaded."}catch(f){this.FeaturesSetting=new settings_1.FeaturesSetting,this.Status="Created."}else this.FeaturesSetting=new settings_1.FeaturesSetting,this.Status="Created."})}loadFeatureTypes(){return __awaiter(this,void 0,void 0,function*(){this.Status="Loading...",this.changeDetectorRef.detectChanges();let b=yield this.mcds.readFeatureTypesSetting(util.cookie.get("username"),util.cookie.get("password"));if(b&&"string"==typeof b)try{this.FeatureTypes=yield errisy_bindable_1.obs.unpack(b),this.Status="Loaded."}catch(f){this.FeatureTypes=new settings_1.FeatureTypes,this.Status="Created."}else this.FeatureTypes=new settings_1.FeatureTypes,this.Status="Created.";this.FeatureTypes})}Save(){return __awaiter(this,void 0,void 0,function*(){this.Status="Saving...",yield this.mcds.writeFeaturesSetting(util.cookie.get("username"),util.cookie.get("password"),errisy_bindable_1.obs.pack(this.FeaturesSetting)),this.Status="Saved."})}addFeature(){let b=new genefile_1.Feature;b.Name="New Site",this.FeaturesSetting.Features.push(b)}removeFeature(b){let f=this.FeaturesSetting.Features.indexOf(b);-1<f&&(this.FeaturesSetting.Features.splice(f,1),this.selectedFeature==b&&this.selectFeature(void 0))}selectFeature(b){this.selectedFeature=b}};FeatureManagement=__decorate([core_1.Component({selector:"feature-manage",templateUrl:"management/feature.component.html",providers:[mcds_client_1.MCDSCore]}),__metadata("design:paramtypes",["function"==typeof(_a="undefined"!=typeof mcds_client_1.MCDSCore&&mcds_client_1.MCDSCore)&&_a||Object,core_1.ChangeDetectorRef])],FeatureManagement),exports.FeatureManagement=FeatureManagement;var _a;