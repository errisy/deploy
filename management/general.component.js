"use strict";var _createClass=function(){function a(b,f){for(var h,g=0;g<f.length;g++)h=f[g],h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(b,h.key,h)}return function(b,f,g){return f&&a(b.prototype,f),g&&a(b,g),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var __decorate=function(a,b,f,g){var l,h=arguments.length,j=3>h?b:null===g?g=Object.getOwnPropertyDescriptor(b,f):g;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)j=Reflect.decorate(a,b,f,g);else for(var m=a.length-1;0<=m;m--)(l=a[m])&&(j=(3>h?l(j):3<h?l(b,f,j):l(b,f))||j);return 3<h&&j&&Object.defineProperty(b,f,j),j},__metadata=function(a,b){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=function(a,b,f,g){return new(f||(f=Promise))(function(h,j){function l(o){try{n(g.next(o))}catch(p){j(p)}}function m(o){try{n(g["throw"](o))}catch(p){j(p)}}function n(o){o.done?h(o.value):new f(function(p){p(o.value)}).then(l,m)}n((g=g.apply(a,b)).next())})},core_1=require("@angular/core"),content_1=require("ui/content"),management_client_1=require("management/management.client"),util=require("errisy-util"),errisy_ui_1=require("errisy-ui"),GeneralComponent=function(){function a(b,f,g){var h=this;_classCallCheck(this,a),this.manage=b,this.parent=f,this.changeDetectorRef=g,this.PasswordModel=new errisy_ui_1.NewPasswordModel,this.Tabs=[{Title:"Information",View:[[errisy_ui_1.fields.text("_id","Username").readonly()],[errisy_ui_1.fields.text("name","Name").attr({maxlength:64})],[errisy_ui_1.fields.text("email","Email").verify(errisy_ui_1.verifictions.email).attr({maxlength:64})],[errisy_ui_1.fields.text("Company","Company Name").attr({maxlength:128})],[errisy_ui_1.fields.text("ContactPhone","Contact Phone").attr({maxlength:32})],errisy_ui_1.rows.text(errisy_ui_1.fields.textarea("BillingAddress","Billing Address").attr({maxlength:128})),errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Update").event("click",this,function(){return __awaiter(h,void 0,void 0,regeneratorRuntime.mark(function j(){return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.View.Verify();case 2:if(m.sent){m.next=4;break}return m.abrupt("return");case 4:return this.parent.Status="Updating Information...",m.next=7,this.manage.UpdateAccountInformation(this.View.Entity);case 7:if(!m.sent){m.next=11;break}this.parent.Status="Information Updated.",m.next=12;break;case 11:this.parent.Status="Failed to Update Information.";case 12:case"end":return m.stop();}},j,this)}))}))],Entity:function(){return __awaiter(h,void 0,void 0,regeneratorRuntime.mark(function l(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.manage.GetAccountInformation();case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop();}},l,this)}))}},{Title:"Activate/Change Mobile",View:[[errisy_ui_1.fields.text("active","Your Mobile Status").readonly()],[errisy_ui_1.fields.text("mobile","Mobile Phone Number").event("keydown",errisy_ui_1.filters,errisy_ui_1.filters.numbers).attr({maxlength:10})],errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Get Activation Code").event("click",this,function(){return __awaiter(h,void 0,void 0,regeneratorRuntime.mark(function j(){return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return this.parent.Status="Trying to get Verification Code...",m.prev=1,m.next=4,this.manage.getMobileVerificationCode(this.View.Entity.mobile);case 4:if(!m.sent){m.next=6;break}this.parent.Status="Verfication code will be sent to you in a minute.";case 6:m.next=11;break;case 8:m.prev=8,m.t0=m["catch"](1),this.parent.Status=m.t0;case 11:case"end":return m.stop();}},j,this,[[1,8]])}))})),[errisy_ui_1.fields.text("code","Activation Code").event("keydown",errisy_ui_1.filters,errisy_ui_1.filters.numbers).verify(errisy_ui_1.verifictions.fixedLength(6)).attr({maxlength:6})],errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Activate").event("click",this,function(){return __awaiter(h,void 0,void 0,regeneratorRuntime.mark(function j(){return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(this.View.Verify()){m.next=2;break}return m.abrupt("return");case 2:return this.parent.Status="Trying to verify your mobile...",m.prev=3,m.next=6,this.manage.verifyMobile(this.View.Entity.code);case 6:if(!m.sent){m.next=9;break}this.View.Entity.active="Active",this.parent.Status="Your mobile is activated!";case 9:m.next=14;break;case 11:m.prev=11,m.t0=m["catch"](3),this.parent.Status=m.t0;case 14:case"end":return m.stop();}},j,this,[[3,11]])}))}))],Entity:function(){return __awaiter(h,void 0,void 0,regeneratorRuntime.mark(function l(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.manage.getActivationEntity();case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop();}},l,this)}))}},{Title:"Change Password",View:[[errisy_ui_1.fields.password("password","Old Password").verify(errisy_ui_1.verifictions.required)],[errisy_ui_1.fields.password1(this.PasswordModel,"New"),errisy_ui_1.fields.password2(this.PasswordModel,"Repeat")],errisy_ui_1.rows.buttons(errisy_ui_1.fields.submit("Change Password").event("click",this,function(){return __awaiter(h,void 0,void 0,regeneratorRuntime.mark(function j(){return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.t0=console,m.next=3,this.View.Verify();case 3:return m.t1=m.sent,m.t0.log.call(m.t0,"verify ",m.t1),m.next=7,this.View.Verify();case 7:if(m.sent){m.next=9;break}return m.abrupt("return");case 9:if(this.parent.Status="Trying to change your password...",console.log(this.View.Entity,this.PasswordModel.Value),this.PasswordModel.Value){m.next=13;break}return m.abrupt("return");case 13:return m.prev=13,m.next=16,this.manage.changePassword(util.md5(this.View.Entity.password),util.md5(this.PasswordModel.Value));case 16:if(!m.sent){m.next=21;break}this.parent.Status="Password Changed.",this.PasswordModel.Value="",m.next=22;break;case 21:this.parent.Status="Failed to change your password.";case 22:m.next=27;break;case 24:m.prev=24,m.t2=m["catch"](13),this.parent.Status=m.t2;case 27:case"end":return m.stop();}},j,this,[[13,24]])}))}))],Entity:function(){return __awaiter(h,void 0,void 0,regeneratorRuntime.mark(function l(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",{password:""});case 1:case"end":return n.stop();}},l,this)}))}}]}return _createClass(a,[{key:"ngAfterContentInit",value:function(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function f(){return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.parent.checkLogin();case 2:if(h.sent){h.next=5;break}return this.parent.select(0),h.abrupt("return");case 5:if(this.parent.Title="General Setting",this.SelectedTab){h.next=9;break}return h.next=9,this.SelectTab(this.Tabs[0]);case 9:this.changeDetectorRef.markForCheck();case 10:case"end":return h.stop();}},f,this)}))}},{key:"SelectTab",value:function(f){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function g(){return regeneratorRuntime.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return this.SelectedTab=f,this.View.Load(f.View),j.next=4,f.Entity();case 4:this.View.Entity=j.sent;case 5:case"end":return j.stop();}},g,this)}))}}]),a}();__decorate([core_1.ViewChild("header"),__metadata("design:type",errisy_ui_1.InfoTableControl)],GeneralComponent.prototype,"Header",void 0),__decorate([core_1.ViewChild("view"),__metadata("design:type",errisy_ui_1.InfoTableControl)],GeneralComponent.prototype,"View",void 0),GeneralComponent=__decorate([core_1.Component({selector:"crispr-site",template:" <div class=\"flex-column-stretch flex-stretch\"> <div class=\"flex-row-stretch view-title\"> <div class=\"flex-row-center flex-stretch flex-center\"> <span style=\"cursor: default; user-select: none\">{{parent.Title}}</span> </div> </div> <div class=\"flex-column-stretch flex-stretch flex-center warm-gradient\"> <div class=\"flex-row-stretch tab\"> <div *ngFor=\"let tab of Tabs\" [class.selected]=\"SelectedTab==tab\" (click)=\"SelectTab(tab)\">{{tab.Title}}</div> </div> <div class=\"flex-column-center flex-stretch flex-start\"> <div info-table #view> </div> </div> </div> <div class=\"flex-row-center view-status\"> {{parent.Status}} </div> </div>",providers:[management_client_1.ManageCore]}),__metadata("design:paramtypes",[management_client_1.ManageCore,content_1.ContentControl,core_1.ChangeDetectorRef])],GeneralComponent),exports.GeneralComponent=GeneralComponent;