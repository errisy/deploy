"use strict";var __decorate=this&&this.__decorate||function(a,b,f,g){var l,h=arguments.length,j=3>h?b:null===g?g=Object.getOwnPropertyDescriptor(b,f):g;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)j=Reflect.decorate(a,b,f,g);else for(var m=a.length-1;0<=m;m--)(l=a[m])&&(j=(3>h?l(j):3<h?l(b,f,j):l(b,f))||j);return 3<h&&j&&Object.defineProperty(b,f,j),j},__metadata=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=this&&this.__awaiter||function(a,b,f,g){return new(f||(f=Promise))(function(h,j){function l(p){try{o(g.next(p))}catch(q){j(q)}}function m(p){try{o(g["throw"](p))}catch(q){j(q)}}function o(p){p.done?h(p.value):new f(function(q){q(p.value)}).then(l,m)}o((g=g.apply(a,b)).next())})};const core_1=require("@angular/core"),mcds_client_1=require("../mcds/mcds.client"),util=require("errisy-util"),errisy_bindable_1=require("errisy-bindable"),settings_1=require("../mcds/settings"),nuctions_1=require("../mcds/nuctions"),nucleotide_1=require("./nucleotide");let RecombinationSiteManagement=class{constructor(b,f){this.mcds=b,this.changeDetectorRef=f,this.Nucleotides=[]}ngAfterViewInit(){return __awaiter(this,void 0,void 0,function*(){yield this.loadRecombinationSites(),this.changeDetectorRef.detectChanges()})}loadRecombinationSites(){return __awaiter(this,void 0,void 0,function*(){this.Status="Loading...",this.changeDetectorRef.detectChanges();let b=yield this.mcds.readRecombinationSiteGroupsSetting(util.cookie.get("username"),util.cookie.get("password"));if(b&&"string"==typeof b)try{this.RecombinationSites=yield errisy_bindable_1.obs.unpack(b),this.Status="Loaded."}catch(f){console.log(f),this.RecombinationSites=new settings_1.RecombinationSites,this.Status="Created."}else this.RecombinationSites=new settings_1.RecombinationSites,this.Status="Created."})}Save(){return __awaiter(this,void 0,void 0,function*(){this.checkError()||(this.Status="Saving...",yield this.mcds.writeRecombinationSiteGroupsSetting(util.cookie.get("username"),util.cookie.get("password"),errisy_bindable_1.obs.pack(this.RecombinationSites)),this.Status="Saved.")})}checkError(){let b=this.RecombinationSites.Groups.filter(f=>this.ValidateGroup(f)).length;return!!(0<b)&&(this.Status=b+" Errors found!",!0)}AddGroup(){let b=new nuctions_1.RecombinationSiteGroup;b.Name="New Group",this.RecombinationSites.Groups.push(b)}removeGroup(b){let f=this.RecombinationSites.Groups.indexOf(b);-1<f&&(this.RecombinationSites.Groups.splice(f,1),this.selectedGroup==b&&this.selectGroup(void 0))}AddSite(){if(this.selectedGroup){let b=new nuctions_1.RecombinationSite;b.Name="New Site",b.Type="F",this.selectedGroup.Sites.push(b)}}removeSite(b){if(this.selectedGroup){let f=this.selectedGroup.Sites.indexOf(b);-1<f&&(this.selectedGroup.Sites.splice(f,1),this.selectedSite==b&&this.selectSite(void 0))}}selectGroup(b){this.selectedGroup=b,this.selectSite(void 0)}selectSite(b){this.selectedSite=b,this.GenerateNucleotides()}GenerateNucleotides(){if(this.selectedSite&&(this.Nucleotides=[],this.selectedSite.Sequence&&0!=this.selectedSite.Sequence.length)){for(let f,b=0;b<this.selectedSite.Sequence.length;b++)f=new nucleotide_1.Nucleotide,f.S=this.selectedSite.Sequence.charAt(b),f.A=nuctions_1.Nuctions.ReverseComplementN(f.S),f.Index=b+1,f.SChecked=f.Index==this.selectedSite.SCut,f.AChecked=f.Index==this.selectedSite.ACut,this.Nucleotides.push(f);this.selectedSite.ReEx=nuctions_1.Nuctions.TAGCFilter(this.selectedSite.Sequence)&&0<nuctions_1.Nuctions.TAGCFilter(this.selectedSite.Sequence).length?nuctions_1.Nuctions.buildRegExp(this.selectedSite.Sequence):void 0}}ValidateGroup(b){return!!(1<this.RecombinationSites.Groups.filter(f=>f.Name==b.Name).length)&&"Duplate Name"}Validate(b,f){return b?b.Name?b.Sequence?"number"==typeof b.ACut?"number"==typeof b.SCut?b.ReEx?!!(1<f.Sites.filter(g=>g.Name==b.Name).length)&&"Duplate Name":"No Regular Expression":"No SCut":"No ACut":"No Sequence":"No Name":"Invalid Enzyme"}};RecombinationSiteManagement=__decorate([core_1.Component({selector:"recombination-site",templateUrl:"management/recombinationsite.component.html",providers:[mcds_client_1.MCDSCore]}),__metadata("design:paramtypes",["function"==typeof(_a="undefined"!=typeof mcds_client_1.MCDSCore&&mcds_client_1.MCDSCore)&&_a||Object,core_1.ChangeDetectorRef])],RecombinationSiteManagement),exports.RecombinationSiteManagement=RecombinationSiteManagement;var _a;