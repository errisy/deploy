"use strict";var __decorate=this&&this.__decorate||function(a,b,f,g){var l,h=arguments.length,j=3>h?b:null===g?g=Object.getOwnPropertyDescriptor(b,f):g;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)j=Reflect.decorate(a,b,f,g);else for(var m=a.length-1;0<=m;m--)(l=a[m])&&(j=(3>h?l(j):3<h?l(b,f,j):l(b,f))||j);return 3<h&&j&&Object.defineProperty(b,f,j),j},__metadata=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=this&&this.__awaiter||function(a,b,f,g){return new(f||(f=Promise))(function(h,j){function l(p){try{o(g.next(p))}catch(q){j(q)}}function m(p){try{o(g["throw"](p))}catch(q){j(q)}}function o(p){p.done?h(p.value):new f(function(q){q(p.value)}).then(l,m)}o((g=g.apply(a,b)).next())})};const core_1=require("@angular/core"),mcds_client_1=require("../mcds/mcds.client"),settings_1=require("../mcds/settings"),nuctions_1=require("../mcds/nuctions"),errisy_bindable_1=require("errisy-bindable"),util=require("errisy-util"),nucleotide_1=require("./nucleotide"),restrictionenzymes_1=require("../mcds/restrictionenzymes");let RestrictionEnzymeManagement=class{constructor(b,f){this.mcds=b,this.changeDetectorRef=f,this.Nucleotides=[]}ngAfterViewInit(){return __awaiter(this,void 0,void 0,function*(){yield this.loadRestrictionEnzymes(),this.changeDetectorRef.detectChanges()})}loadRestrictionEnzymes(){return __awaiter(this,void 0,void 0,function*(){this.Status="Loading...",this.changeDetectorRef.detectChanges();let b=yield this.mcds.readRestrictionEnzymesSetting(util.cookie.get("username"),util.cookie.get("password"));if(b&&"string"==typeof b)try{this.RestrictionEnzymes=yield errisy_bindable_1.obs.unpack(b),this.Status="Loaded."}catch(f){this.RestrictionEnzymes=new settings_1.RestrictionEnzymes,this.Status="Created."}else this.RestrictionEnzymes=new settings_1.RestrictionEnzymes,this.Status="Created."})}LoadStandardLibrary(){restrictionenzymes_1.StandardRestrictionEnzymeList.forEach(b=>{this.RestrictionEnzymes.Enzymes.some(f=>f.Name==b.Name)||this.RestrictionEnzymes.Enzymes.push(b)})}Save(){return __awaiter(this,void 0,void 0,function*(){this.checkError()||(this.Status="Saving...",yield this.mcds.writeRestrictionEnzymesSetting(util.cookie.get("username"),util.cookie.get("password"),errisy_bindable_1.obs.pack(this.RestrictionEnzymes)),this.Status="Saved.")})}checkError(){let b=this.RestrictionEnzymes.Enzymes.filter(f=>this.Validate(f)).length;return!!(0<b)&&(this.Status=b+" Errors found!",!0)}AddEnzyme(){let b=new nuctions_1.RestrictionEnzyme;b.Name="New Enzyme",this.RestrictionEnzymes.Enzymes.push(b)}removeEnzyme(b){let f=this.RestrictionEnzymes.Enzymes.indexOf(b);-1<f&&(this.RestrictionEnzymes.Enzymes.splice(f,1),this.selectedEnzyme==b&&this.selectEnzyme(void 0))}selectEnzyme(b){this.selectedEnzyme=b,this.GenerateNucleotides()}GenerateNucleotides(){if(this.selectedEnzyme&&(this.Nucleotides=[],this.selectedEnzyme.Sequence&&0!=this.selectedEnzyme.Sequence.length)){for(let f,b=0;b<this.selectedEnzyme.Sequence.length;b++)f=new nucleotide_1.Nucleotide,f.S=this.selectedEnzyme.Sequence.charAt(b),f.A=nuctions_1.Nuctions.ReverseComplementN(f.S),f.Index=b+1,f.SChecked=f.Index==this.selectedEnzyme.SCut,f.AChecked=f.Index==this.selectedEnzyme.ACut,this.Nucleotides.push(f);this.selectedEnzyme.ReEx=nuctions_1.Nuctions.TAGCFilter(this.selectedEnzyme.Sequence)&&0<nuctions_1.Nuctions.TAGCFilter(this.selectedEnzyme.Sequence).length?nuctions_1.Nuctions.buildRegExp(this.selectedEnzyme.Sequence):void 0}}Validate(b){return b?b.Name?b.Sequence?"number"==typeof b.ACut?"number"==typeof b.SCut?b.ReEx?!!(1<this.RestrictionEnzymes.Enzymes.filter(f=>f.Name==b.Name).length)&&"Duplate Name":"No Regular Expression":"No SCut":"No ACut":"No Sequence":"No Name":"Invalid Enzyme"}};RestrictionEnzymeManagement=__decorate([core_1.Component({selector:"restriction-enzyme",templateUrl:"management/restrictionenzyme.component.html",providers:[mcds_client_1.MCDSCore]}),__metadata("design:paramtypes",["function"==typeof(_a="undefined"!=typeof mcds_client_1.MCDSCore&&mcds_client_1.MCDSCore)&&_a||Object,core_1.ChangeDetectorRef])],RestrictionEnzymeManagement),exports.RestrictionEnzymeManagement=RestrictionEnzymeManagement;var _a;