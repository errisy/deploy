"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},__decorate=function(a,b,g,h){var m,j=arguments.length,l=3>j?b:null===h?h=Object.getOwnPropertyDescriptor(b,g):h;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)l=Reflect.decorate(a,b,g,h);else for(var o=a.length-1;0<=o;o--)(m=a[o])&&(l=(3>j?m(l):3<j?m(b,g,l):m(b,g))||l);return 3<j&&l&&Object.defineProperty(b,g,l),l},__metadata=function(a,b){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=function(a,b,g,h){return new(g||(g=Promise))(function(j,l){function m(q){try{p(h.next(q))}catch(s){l(s)}}function o(q){try{p(h["throw"](q))}catch(s){l(s)}}function p(q){q.done?j(q.value):new g(function(s){s(q.value)}).then(m,o)}p((h=h.apply(a,b)).next())})},__generator=function(a,b){function g(p){return function(q){return h([p,q])}}function h(p){if(l)throw new TypeError("Generator is already executing.");for(;j;)try{if(l=1,m&&(o=m[2&p[0]?"return":p[0]?"throw":"next"])&&!(o=o.call(m,p[1])).done)return o;switch((m=0,o)&&(p=[0,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return j.label++,{value:p[1],done:!1};case 5:j.label++,m=p[1],p=[0];continue;case 7:p=j.ops.pop(),j.trys.pop();continue;default:if((o=j.trys,!(o=0<o.length&&o[o.length-1]))&&(6===p[0]||2===p[0])){j=0;continue}if(3===p[0]&&(!o||p[1]>o[0]&&p[1]<o[3])){j.label=p[1];break}if(6===p[0]&&j.label<o[1]){j.label=o[1],o=p;break}if(o&&j.label<o[2]){j.label=o[2],j.ops.push(p);break}o[2]&&j.ops.pop(),j.trys.pop();continue;}p=b.call(a,j)}catch(q){p=[6,q],m=0}finally{l=o=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}var l,m,o,j={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:g(0),"throw":g(1),"return":g(2)}},core_1=require("@angular/core"),forms_1=require("@angular/forms"),ctr_completer_1=require("errisy-completer/directives/ctr-completer"),globals_1=require("errisy-completer/globals");require("rxjs/add/operator/catch");var noop=function(){},COMPLETER_CONTROL_VALUE_ACCESSOR={provide:forms_1.NG_VALUE_ACCESSOR,useExisting:core_1.forwardRef(function(){return CompleterCmp}),multi:!0},CompleterCmp=function(){function a(){var b=this;this.inputName="",this.pause=globals_1.PAUSE,this.minSearchLength=globals_1.MIN_SEARCH_LENGTH,this.maxChars=globals_1.MAX_CHARS,this.overrideSuggested=!1,this.clearSelected=!1,this.placeholder="",this.textSearching=globals_1.TEXT_SEARCHING,this.textNoResults=globals_1.TEXT_NORESULTS,this.autoMatch=!1,this.disableInput=!1,this.selected=new core_1.EventEmitter,this.highlighted=new core_1.EventEmitter,this.blur=new core_1.EventEmitter,this.focus=new core_1.EventEmitter,this.keydown=new core_1.EventEmitter,this.searchStr="",this.displaySearching=!0,this._onTouchedCallback=noop,this._onChangeCallback=noop,this.onItemSelectd=function(g){switch(b.dataMode){case"field":g&&g.originalObject?(b._objectValue=g.originalObject,b.selected.emit(g),b._onChangeCallback(g.originalObject)):(b._objectValue=null,b.selected.emit(null),b._onChangeCallback(void 0));break;case"id":g&&g.originalObject?(b._objectValue=g.originalObject,b.selected.emit(g),b._onChangeCallback(b._objectValue._id)):(b._objectValue=null,b.selected.emit(null),b._onChangeCallback(void 0));break;case void 0:default:{var h=g?g.title:"";b.selected.emit(g),b._onChangeCallback(h)}}}}return Object.defineProperty(a.prototype,"value",{get:function(){return this.searchStr},set:function(g){g!==this.searchStr&&(this.searchStr=g,this._onChangeCallback(g))},enumerable:!0,configurable:!0}),a.prototype.onTouched=function(){this._onTouchedCallback()},a.prototype.writeValue=function(b){return __awaiter(this,void 0,void 0,function(){var g,h,j;return __generator(this,function(l){switch(l.label){case 0:return g=this.dataMode,"field"===g?[3,1]:"id"===g?[3,2]:void 0==g?[3,8]:[3,8];case 1:return this._objectValue=b,this.searchStr=b[this.titleField],[3,9];case 2:return(l.trys.push([2,6,,7]),!b)?[3,4]:(this.searchStr="[loading obj by id...]",h=this,[4,this.fetcher.fetch([b])]);case 3:return h._objectValue=l.sent()[0],this.searchStr=this._objectValue?this._objectValue[this.titleField]:"",[3,5];case 4:this.searchStr="",l.label=5;case 5:return[3,7];case 6:return j=l.sent(),[3,7];case 7:return[3,9];case 8:return this.searchStr=b,[3,9];case 9:return[2];}})})},a.prototype.registerOnChange=function(b){this._onChangeCallback=b},a.prototype.registerOnTouched=function(b){this._onTouchedCallback=b},a.prototype.setRawValue=function(b){this.dataMode||this._onChangeCallback(b)},a.prototype.ngOnInit=function(){var b=this;this.completer.selected.subscribe(this.onItemSelectd),this.completer.highlighted.subscribe(function(g){b.highlighted.emit(g)}),"false"===this.textSearching&&(this.displaySearching=!1)},a.prototype.onBlur=function(){this.blur.emit(),this.onTouched()},a.prototype.onFocus=function(){this.focus.emit()},a.prototype.onKeyDown=function(b){this.completer.dropdown||this.keydown.emit(b)},a.prototype.open=function(b){void 0===b&&(b=""),this.completer.search(b)},a.prototype.close=function(){this.completer.clear()},a.prototype.SetFocus=function(){if(this.inputElement&&this.inputElement.nativeElement){var b=this.inputElement.nativeElement;b.focus()}},a}();__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"dataService",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"inputName",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"pause",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"minSearchLength",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"maxChars",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"overrideSuggested",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"clearSelected",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"placeholder",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],CompleterCmp.prototype,"matchClass",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"textSearching",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"textNoResults",void 0),__decorate([core_1.Input(),__metadata("design:type",Number)],CompleterCmp.prototype,"fieldTabindex",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"autoMatch",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"disableInput",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],CompleterCmp.prototype,"inputClass",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"dataMode",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],CompleterCmp.prototype,"titleField",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],CompleterCmp.prototype,"fetcher",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],CompleterCmp.prototype,"searchFields",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],CompleterCmp.prototype,"selected",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],CompleterCmp.prototype,"highlighted",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],CompleterCmp.prototype,"blur",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],CompleterCmp.prototype,"focus",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],CompleterCmp.prototype,"keydown",void 0),__decorate([core_1.ViewChild(ctr_completer_1.CtrCompleter),__metadata("design:type",ctr_completer_1.CtrCompleter)],CompleterCmp.prototype,"completer",void 0),__decorate([core_1.ViewChild("input"),__metadata("design:type",core_1.ElementRef)],CompleterCmp.prototype,"inputElement",void 0),CompleterCmp=__decorate([core_1.Component({selector:"auto-completer",template:"\n        <div class=\"completer-holder\" ctrCompleter>\n            <input #input class=\"completer-input\" ctrInput [ngClass]=\"inputClass\" [(ngModel)]=\"searchStr\" (keydown)=\"onKeyDown($event)\" (ngModelChange)=\"setRawValue($event)\" [attr.name]=\"inputName\" [placeholder]=\"placeholder\" [attr.maxlength]=\"maxChars\"\n                [tabindex]=\"fieldTabindex\" [disabled]=\"disableInput\" [clearSelected]=\"clearSelected\" [overrideSuggested]=\"overrideSuggested\" (blur)=\"onBlur()\" (focus)=\"onFocus()\"\n                autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" />\n\n            <div class=\"completer-dropdown-holder\" *ctrList=\"dataService; minSearchLength: minSearchLength; pause: pause; autoMatch: autoMatch; let items = results; let searchActive = searching; let isInitialized = searchInitialized;\">\n                <div class=\"completer-dropdown\" ctrDropdown *ngIf=\"isInitialized\">\n                    <div *ngIf=\"searchActive && displaySearching\" class=\"completer-searching\">{{textSearching}}</div>\n                    <div *ngIf=\"!searchActive && (!items || items.length === 0)\" class=\"completer-no-results\">{{textNoResults}}</div>\n                    <div class=\"completer-row-wrapper\" *ngFor=\"let item of items; let rowIndex=index\">\n                        <div class=\"completer-row\" [ctrRow]=\"rowIndex\" [dataItem]=\"item\">\n                            <div *ngIf=\"item.image || item.image === ''\" class=\"completer-image-holder\">\n                                <img *ngIf=\"item.image != ''\" src=\"{{item.image}}\" class=\"completer-image\" />\n                                <div *ngIf=\"item.image === ''\" class=\"completer-image-default\"></div>\n                            </div>\n                            <div class=\"completer-item-text\" [ngClass]=\"{'completer-item-text-image': item.image || item.image === '' }\">\n                                <completer-list-item class=\"completer-title\" [text]=\"item.title\" [matchClass]=\"matchClass\" [searchStr]=\"searchStr\" [type]=\"'title'\"></completer-list-item>\n                                <completer-list-item *ngIf=\"item.description && item.description != ''\" class=\"completer-description\" [text]=\"item.description\"\n                                    [matchClass]=\"matchClass\" [searchStr]=\"searchStr\" [type]=\"'description'\">\n                                </completer-list-item>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ",styles:["\n    .completer-dropdown {\n        border-color: #ececec;\n        border-width: 1px;\n        border-style: solid;\n        border-radius: 2px;\n        width: 250px;\n        padding: 6px;\n        cursor: pointer;\n        z-index: 9999;\n        position: absolute;\n        margin-top: -6px;\n        background-color: #ffffff;\n    }\n\n    .completer-row {\n        padding: 5px;\n        color: #000000;\n        margin-bottom: 4px;\n        clear: both;\n        display: inline-block;\n        width: 103%;\n    }\n\n    .completer-selected-row {\n        background-color: lightblue;\n        color: #ffffff;\n    }\n\n    .completer-description {\n        font-size: 14px;\n    }\n\n    .completer-image-default {\n        width: 16px; \n        height: 16px;\n        background-image: url(\"demo/res/img/default.png\");\n    }\n\n    .completer-image-holder {\n        float: left;\n        width: 10%;\n    }\n    .completer-item-text-image {\n        float: right;\n        width: 90%;\n    }\n    "],providers:[COMPLETER_CONTROL_VALUE_ACCESSOR]}),__metadata("design:paramtypes",[])],CompleterCmp),exports.CompleterCmp=CompleterCmp;