"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},__decorate=function(a,b,f,g){var l,h=arguments.length,j=3>h?b:null===g?g=Object.getOwnPropertyDescriptor(b,f):g;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)j=Reflect.decorate(a,b,f,g);else for(var m=a.length-1;0<=m;m--)(l=a[m])&&(j=(3>h?l(j):3<h?l(b,f,j):l(b,f))||j);return 3<h&&j&&Object.defineProperty(b,f,j),j},__metadata=function(a,b){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},core_1=require("@angular/core"),datetime_picker_component_1=require("errisy-datetime/datetime-picker.component"),datetime_1=require("errisy-datetime/datetime"),DateTimePickerDirective=function(){function a(b,f){var g=this;this.resolver=b,this.viewContainerRef=f,this.ngModelChange=new core_1.EventEmitter,this.hideDatetimePicker=function(h){g._componentRef&&(h&&"click"===h.type&&h.target!==g._el&&!g._elementIn(h.target,g._datetimePickerEl)?(g._componentRef.destroy(),g._componentRef=void 0):!h&&(g._componentRef.destroy(),g._componentRef=void 0))},this.keyEventListener=function(h){27===h.keyCode&&g.hideDatetimePicker()},this._el=this.viewContainerRef.element.nativeElement}return a.prototype.ngOnInit=function(){var b=document.createElement("div");b.className="ng2-datetime-picker",b.style.display="inline-block",b.style.position="relative",this._el.parentElement.insertBefore(b,this._el.nextSibling),b.appendChild(this._el),document.body.addEventListener("click",this.hideDatetimePicker),this._el.addEventListener("keyup",this.keyEventListener)},a.prototype.ngAfterViewChecked=function(){if(this._el.dateValue instanceof Date){var b=this._getFormattedDateStr();b!==this._el.value&&(this._el.value=b)}},a.prototype.ngOnChanges=function(b){void 0!==b.ngModel&&(this.valueChanged(b.ngModel.currentValue,!1),void 0!==this._componentRef&&this._componentRef.instance.initDateTime(this._el.dateValue))},a.prototype.ngOnDestroy=function(){document.body.removeEventListener("click",this.hideDatetimePicker),this._el.removeEventListener("keyup",this.keyEventListener),this._datetimePickerEl&&this._datetimePickerEl.removeEventListener("keyup",this.keyEventListener)},a.prototype.valueChanged=function(b,f){var g=this;void 0===f&&(f=!0),this._el.dateValue="string"==typeof b&&b?this._getDate(b):"object"===("undefined"==typeof b?"undefined":_typeof(b))?b:null,this._el.value=this._getFormattedDateStr(),this.ngModel=this._el.dateValue,this.ngModel&&(this.ngModel.toString=function(){return g._el.value},f&&this.ngModelChange.emit(this.ngModel))},a.prototype.showDatetimePicker=function(){var b=this;if(!this._componentRef){var f=this.resolver.resolveComponentFactory(datetime_picker_component_1.DateTimePickerComponent);this._componentRef=this.viewContainerRef.createComponent(f),this._datetimePickerEl=this._componentRef.location.nativeElement,this._datetimePickerEl.addEventListener("keyup",this.keyEventListener);var g=this._componentRef.instance;g.initDateTime(this._el.dateValue),g.dateOnly=this.dateOnly,this._styleDatetimePicker(),g.changes.subscribe(function(h){b.valueChanged(h)}),g.closing.subscribe(function(){"false"!==b.closeOnSelect&&b.hideDatetimePicker()})}},a.prototype._elementIn=function(b,f){for(;b=b.parentNode;)if(b===f)return!0;return!1},a.prototype._styleDatetimePicker=function(){var b=this,f=this._el.getBoundingClientRect();this._datetimePickerEl.style.width=f.width+"px",this._datetimePickerEl.style.position="absolute",this._datetimePickerEl.style.zIndex="1000",this._datetimePickerEl.style.left="0",this._datetimePickerEl.style.transition="height 0.3s ease-in",this._datetimePickerEl.style.visibility="hidden",setTimeout(function(){var g=b._el.getBoundingClientRect(),h=b._datetimePickerEl.getBoundingClientRect();g.bottom+h.height>window.innerHeight?b._datetimePickerEl.style.bottom="0":b._datetimePickerEl.style.top=g.height+"px",b._datetimePickerEl.style.visibility="visible"})},(a.prototype._getFormattedDateStr=function(){return this._el.dateValue?this.dateFormat?datetime_1.DateTime.momentFormatDate(this._el.dateValue,this.dateFormat):datetime_1.DateTime.formatDate(this._el.dateValue,this.dateOnly):null},a.prototype._getDate=function(b){var f;return f="string"==typeof b?this.dateFormat?datetime_1.DateTime.momentParse(b):datetime_1.DateTime.parse(b):b,f},a)}();__decorate([core_1.Input("date-format"),__metadata("design:type",String)],DateTimePickerDirective.prototype,"dateFormat",void 0),__decorate([core_1.Input("date-only"),__metadata("design:type",Boolean)],DateTimePickerDirective.prototype,"dateOnly",void 0),__decorate([core_1.Input("close-on-select"),__metadata("design:type",String)],DateTimePickerDirective.prototype,"closeOnSelect",void 0),__decorate([core_1.Input("ngModel"),__metadata("design:type",Object)],DateTimePickerDirective.prototype,"ngModel",void 0),__decorate([core_1.Output("ngModelChange"),__metadata("design:type",Object)],DateTimePickerDirective.prototype,"ngModelChange",void 0),DateTimePickerDirective=__decorate([core_1.Directive({selector:"[datetime-picker], [ng2-datetime-picker]",providers:[datetime_1.DateTime],host:{"(click)":"showDatetimePicker()","(focus)":"showDatetimePicker()","(change)":"valueChanged($event)"}}),__metadata("design:paramtypes",[core_1.ComponentFactoryResolver,core_1.ViewContainerRef])],DateTimePickerDirective),exports.DateTimePickerDirective=DateTimePickerDirective;