"use strict";var __decorate=this&&this.__decorate||function(a,b,g,h){var m,j=arguments.length,l=3>j?b:null===h?h=Object.getOwnPropertyDescriptor(b,g):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(a,b,g,h);else for(var o=a.length-1;0<=o;o--)(m=a[o])&&(l=(3>j?m(l):3<j?m(b,g,l):m(b,g))||l);return 3<j&&l&&Object.defineProperty(b,g,l),l},__metadata=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=this&&this.__awaiter||function(a,b,g,h){return new(g||(g=Promise))(function(j,l){function m(q){try{p(h.next(q))}catch(s){l(s)}}function o(q){try{p(h["throw"](q))}catch(s){l(s)}}function p(q){q.done?j(q.value):new g(function(s){s(q.value)}).then(m,o)}p((h=h.apply(a,b)).next())})},__generator=this&&this.__generator||function(a,b){function g(p){return function(q){return h([p,q])}}function h(p){if(l)throw new TypeError("Generator is already executing.");for(;j;)try{if(l=1,m&&(o=m[2&p[0]?"return":p[0]?"throw":"next"])&&!(o=o.call(m,p[1])).done)return o;switch((m=0,o)&&(p=[0,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return j.label++,{value:p[1],done:!1};case 5:j.label++,m=p[1],p=[0];continue;case 7:p=j.ops.pop(),j.trys.pop();continue;default:if((o=j.trys,!(o=0<o.length&&o[o.length-1]))&&(6===p[0]||2===p[0])){j=0;continue}if(3===p[0]&&(!o||p[1]>o[0]&&p[1]<o[3])){j.label=p[1];break}if(6===p[0]&&j.label<o[1]){j.label=o[1],o=p;break}if(o&&j.label<o[2]){j.label=o[2],j.ops.push(p);break}o[2]&&j.ops.pop(),j.trys.pop();continue;}p=b.call(a,j)}catch(q){p=[6,q],m=0}finally{l=o=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}var l,m,o,j={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:g(0),"throw":g(1),"return":g(2)}},core_1=require("@angular/core"),compiler_1=require("@angular/compiler"),errisy_parser_1=require("errisy-parser"),NgCompiler=NgCompiler_1=function(){function a(b){this.compiler=b}return a.prototype.Compile=function(b,g){for(var h=[],j=2;j<arguments.length;j++)h[j-2]=arguments[j];return __awaiter(this,void 0,void 0,function(){var l,m,o,p;return __generator(this,function(q){switch(q.label){case 0:return l={decoratedClass:void 0,module:void 0,factory:void 0},l.decoratedClass=b(g),m=function(){return function(){}}(),m=__decorate([core_1.NgModule({imports:h.slice(),declarations:[l.decoratedClass]}),__metadata("design:paramtypes",[])],m),o=m,[4,this.compiler.compileModuleAndAllComponentsAsync(o)];case 1:return p=q.sent(),l.module=o,l.factory=p.componentFactories.find(function(s){return s.componentType==l.decoratedClass}),[2,l];}})})},a.LoadTemplate=function(b){return __awaiter(this,void 0,void 0,function(){var g,h,j;return __generator(this,function(l){switch(l.label){case 0:return"object"==typeof b&&b.Value?[2,b.Value]:[3,1];case 1:return g=b.indexOf("#"),h=void 0,-1<g&&(h=b.substr(g+1),b=b.substr(0,g)),[4,NgCompiler_1.LoadString(b)];case 2:return j=l.sent(),h&&(j=NgCompiler_1.findID(j,h)),[2,j];}})})},a.LoadString=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2,new Promise(function(h,j){var l=new XMLHttpRequest;l.onreadystatechange=function(){4==l.readyState&&200==l.status&&h(l.responseText)},l.onabort=function(m){j(m.error)},l.onerror=function(m){j(m.error)},l.open("GET",b,!0),l.send()})]})})},a.findID=function(b,g){var h=errisy_parser_1.HTMLParser.parse(b),j=h.findById(g),l=h.html.substring(j.start,j.end),m=j.attributes.find(function(o){return"id"==o.key&&o.value==g});return l.substring(0,m.start-j.start)+l.substring(m.end-j.start)},a.searchChildren=function(b,g){if(b.hasChildNodes())for(var j,h=0;h<b.childNodes.length;h++){if(j=b.childNodes.item(h),j&&j.getAttribute&&j.getAttribute("id")==g)return j;NgCompiler_1.searchChildren(j,g)}},a}();NgCompiler=NgCompiler_1=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[compiler_1.JitCompiler])],NgCompiler),exports.NgCompiler=NgCompiler;var DynamicTypeBuilder=function(){function a(b){this.compiler=b,this._cacheOfFactories={}}return a.prototype.createComponentFactory=function(b){for(var g=this,h=[],j=1;j<arguments.length;j++)h[j-1]=arguments[j];var l=this._cacheOfFactories[b];if(l)return new Promise(function(p){p(l)});var m=this.createNewComponent(b),o=this.createComponentModule.apply(this,[m].concat(h));return new Promise(function(p){g.compiler.compileModuleAndAllComponentsAsync(o).then(function(q){l=q.componentFactories.find(function(s){return s.componentType==m}),g._cacheOfFactories[b]=l,p(l)})})},a.prototype.createNewComponent=function(b){var g=function(){return function(){}}();return __decorate([core_1.Input(),__metadata("design:type",Object)],g.prototype,"entity",void 0),g=__decorate([core_1.Component({selector:"dynamic-component",template:b}),__metadata("design:paramtypes",[])],g),g},a.prototype.createComponentModule=function(b){for(var g=[],h=1;h<arguments.length;h++)g[h-1]=arguments[h];var j=function(){return function(){}}();return j=__decorate([core_1.NgModule({imports:g.slice(),declarations:[b]}),__metadata("design:paramtypes",[])],j),j},a}();DynamicTypeBuilder=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[compiler_1.JitCompiler])],DynamicTypeBuilder),exports.DynamicTypeBuilder=DynamicTypeBuilder,module&&(module.exports=exports);var NgCompiler_1;