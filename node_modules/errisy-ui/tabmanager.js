"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},__decorate=function(a,b,g,h){var m,j=arguments.length,l=3>j?b:null===h?h=Object.getOwnPropertyDescriptor(b,g):h;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)l=Reflect.decorate(a,b,g,h);else for(var o=a.length-1;0<=o;o--)(m=a[o])&&(l=(3>j?m(l):3<j?m(b,g,l):m(b,g))||l);return 3<j&&l&&Object.defineProperty(b,g,l),l},__metadata=function(a,b){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},__awaiter=function(a,b,g,h){return new(g||(g=Promise))(function(j,l){function m(q){try{p(h.next(q))}catch(s){l(s)}}function o(q){try{p(h["throw"](q))}catch(s){l(s)}}function p(q){q.done?j(q.value):new g(function(s){s(q.value)}).then(m,o)}p((h=h.apply(a,b)).next())})},__generator=function(a,b){function g(p){return function(q){return h([p,q])}}function h(p){if(l)throw new TypeError("Generator is already executing.");for(;j;)try{if(l=1,m&&(o=m[2&p[0]?"return":p[0]?"throw":"next"])&&!(o=o.call(m,p[1])).done)return o;switch((m=0,o)&&(p=[0,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return j.label++,{value:p[1],done:!1};case 5:j.label++,m=p[1],p=[0];continue;case 7:p=j.ops.pop(),j.trys.pop();continue;default:if((o=j.trys,!(o=0<o.length&&o[o.length-1]))&&(6===p[0]||2===p[0])){j=0;continue}if(3===p[0]&&(!o||p[1]>o[0]&&p[1]<o[3])){j.label=p[1];break}if(6===p[0]&&j.label<o[1]){j.label=o[1],o=p;break}if(o&&j.label<o[2]){j.label=o[2],j.ops.push(p);break}o[2]&&j.ops.pop(),j.trys.pop();continue;}p=b.call(a,j)}catch(q){p=[6,q],m=0}finally{l=o=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}var l,m,o,j={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:g(0),"throw":g(1),"return":g(2)}},core_1=require("@angular/core"),index_1=require("errisy-ui/index"),tabview_1=require("errisy-ui/tabview"),errisy_map_1=require("errisy-map"),util=require("errisy-util"),TabManager=function(){function a(b){this.changeDetectorRef=b,this.MapWidth=0,this.location={x:153.028036,y:-27.4761628},this.initPosition(),this.loadGeoPosition()}return a.prototype.ngAfterContentInit=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.UpdateTabs()];case 1:return b.sent(),[2];}})})},Object.defineProperty(a.prototype,"TabManager",{get:function(){return this._TabManager},set:function(g){this._TabManager=g,this.UpdateTabs()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Entity",{get:function(){return this._Entity},set:function(g){this._Entity=g,this.DataSource||(this.tabview.Entity=g)},enumerable:!0,configurable:!0}),a.prototype.onItemSelected=function(b){this.tabview.Entity=b,this.tabview.OnEntityChange(b)},a.prototype.UpdateTabs=function(){return __awaiter(this,void 0,void 0,function(){var b,g,h;return __generator(this,function(j){switch(j.label){case 0:b=[],g=0,j.label=1;case 1:return g<this._TabManager.length?(h=!this._TabManager[g].Condition,h?[3,3]:[4,this._TabManager[g].Condition()]):[3,5];case 2:h=j.sent(),j.label=3;case 3:h&&b.push(this._TabManager[g]),j.label=4;case 4:return g++,[3,1];case 5:return this.Tabs=b,this.Tabs&&0<this.Tabs.length&&this.SelectTab(this.Tabs[0]),[2];}})})},a.prototype.SelectTab=function(b,g){return __awaiter(this,void 0,void 0,function(){var h;return __generator(this,function(j){switch(j.label){case 0:this.SelectedTab=b,this.DataSource=b.Source&&b.Source(),this.MapWidth=b.MapWidth?b.MapWidth:0;try{this.changeDetectorRef.detectChanges()}catch(l){}if(this.data&&this.DataSource){this.data.DataGrid=this.DataSource,this.data.Title=b.Title,this.data.QueryFields=b.Fields,this.data.CanCreate=b.CanCreate,this.data.CanDelete=b.CanDelete,this.data.ItemTemplateUrl=b.DataTemplateUrl;try{this.data.changeDetectorRef.detectChanges()}catch(l){}this.Entity=void 0}return g?(this.Entity=g,[3,3]):[3,1];case 1:return this.tabview&&b.Entity?(h=this,[4,b.Entity()]):[3,3];case 2:h.Entity=j.sent(),j.label=3;case 3:return[2];}})})},Object.defineProperty(a.prototype,"MapWidthPx",{get:function(){return this.MapWidth+"px"},enumerable:!0,configurable:!0}),a.prototype.initPosition=function(){var b=util.cookie.get("lng"),g=util.cookie.get("lat");"string"==typeof g&&/^[\+\-]?(\d+|\d+\.\d*|\.\d+)$/ig.test(g)&&"string"==typeof b&&/^[\+\-]?(\d+|\d+\.\d*|\.\d+)$/ig.test(b)&&(this.location.x=+b,this.location.y=+g)},a.prototype.loadGeoPosition=function(){return __awaiter(this,void 0,void 0,function(){var b,g;return __generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),[4,util.GetGeoLocation()];case 1:return b=h.sent(),this.location={x:b.coords.longitude,y:b.coords.latitude},[3,3];case 2:return g=h.sent(),console.error("Error when Loading Geo Position",g),[3,3];case 3:return[2];}})})},Object.defineProperty(a.prototype,"Location",{get:function(){return this.location},set:function(g){util.cookie.set("lng",g.x+""),util.cookie.set("lat",g.y+""),this.location=g},enumerable:!0,configurable:!0}),a.prototype.onMapReady=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return this.Map=b,[2]})})},a.prototype.addUserMarker=function(b){return __awaiter(this,void 0,void 0,function(){var g,h,j,m;return __generator(this,function(o){switch(o.label){case 0:return console.log("addUserMarker"),[4,errisy_map_1.DraggableMarker()];case 1:return g=o.sent(),this.Map.setCenter(new google.maps.LatLng(b.y,b.x)),h=this,j=g.bind,m={map:this.Map,animation:google.maps.Animation.DROP},[4,errisy_map_1.UserIcon()];case 2:return h.CurrentLocationMarker=new(j.apply(g,[void 0,(m.icon=o.sent(),m.position={lng:b.x,lat:b.y},m.draggable=!0,m)])),[2,this.CurrentLocationMarker];}})})},a}();__decorate([core_1.ViewChild("data"),__metadata("design:type",index_1.DataGridComponent)],TabManager.prototype,"data",void 0),__decorate([core_1.ViewChild("tabview"),__metadata("design:type",tabview_1.TabViewComponent)],TabManager.prototype,"tabview",void 0),__decorate([core_1.Input(),__metadata("design:type",Array),__metadata("design:paramtypes",[Array])],TabManager.prototype,"TabManager",null),__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],TabManager.prototype,"Entity",null),TabManager=__decorate([core_1.Component({selector:"[TabManager]",template:"\n<div class=\"flex-row-stretch flex-fit tab\">\n    <div *ngFor=\"let tab of Tabs\" [class.selected]=\"SelectedTab==tab\" (click)=\"SelectTab(tab)\">{{tab.Title}}</div>\n</div>\n<div class=\"flex-row-stretch flex-stretch\">\n    <div class=\"flex-column-center flex-fit flex-start\" *ngIf=\"DataSource\">\n        <div #data DataGrid (ItemSelected)=\"onItemSelected($event)\">\n        </div>\n    </div>\n    <div class=\"flex-column-center flex-stretch flex-start scroll-y-auto scroll-x-auto\">\n        <div [Tabs]=\"SelectedTab && SelectedTab.Tab\" #tabview>\n        </div>\n    </div>\n    <div google-map [Lng]=\"location.x\" [Lat]=\"location.y\" [Zoom]=\"14\" (MapInit)=\"onMapReady($event);\" style=\"flex-grow: 1; flex-shrink: 1;\" *ngIf=\"MapWidth>0\" [style.flex-basis]=\"MapWidthPx\">\n\n    </div>\n</div>\n"}),__metadata("design:paramtypes",[core_1.ChangeDetectorRef])],TabManager),exports.TabManager=TabManager;