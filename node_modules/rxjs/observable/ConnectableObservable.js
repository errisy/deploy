"use strict";var __extends=function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},Subject_1=require("rxjs/Subject"),Observable_1=require("rxjs/Observable"),Subscriber_1=require("rxjs/Subscriber"),Subscription_1=require("rxjs/Subscription"),ConnectableObservable=function(a){function c(e,f){a.call(this),this.source=e,this.subjectFactory=f,this._refCount=0}return __extends(c,a),c.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},c.prototype.getSubject=function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject},c.prototype.connect=function(){var e=this._connection;return e||(e=this._connection=new Subscription_1.Subscription,e.add(this.source.subscribe(new ConnectableSubscriber(this.getSubject(),this))),e.closed?(this._connection=null,e=Subscription_1.Subscription.EMPTY):this._connection=e),e},c.prototype.refCount=function(){return this.lift(new RefCountOperator(this))},c}(Observable_1.Observable);exports.ConnectableObservable=ConnectableObservable;var ConnectableSubscriber=function(a){function c(e,f){a.call(this,e),this.connectable=f}return __extends(c,a),c.prototype._error=function(e){this._unsubscribe(),a.prototype._error.call(this,e)},c.prototype._complete=function(){this._unsubscribe(),a.prototype._complete.call(this)},c.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var f=e._connection;e._refCount=0,e._subject=null,e._connection=null,f&&f.unsubscribe()}},c}(Subject_1.SubjectSubscriber),RefCountOperator=function(){function a(c){this.connectable=c}return a.prototype.call=function(c,e){var f=this.connectable;f._refCount++;var g=new RefCountSubscriber(c,f),h=e._subscribe(g);return g.closed||(g.connection=f.connect()),h},a}(),RefCountSubscriber=function(a){function c(e,f){a.call(this,e),this.connectable=f}return __extends(c,a),c.prototype._unsubscribe=function(){var e=this.connectable;if(!e)return void(this.connection=null);this.connectable=null;var f=e._refCount;if(0>=f)return void(this.connection=null);if(e._refCount=f-1,1<f)return void(this.connection=null);var g=this.connection,h=e._connection;this.connection=null,h&&(!g||h===g)&&h.unsubscribe()},c}(Subscriber_1.Subscriber);