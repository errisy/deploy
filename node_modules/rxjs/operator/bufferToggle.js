"use strict";var __extends=function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},Subscription_1=require("rxjs/Subscription"),subscribeToResult_1=require("rxjs/util/subscribeToResult"),OuterSubscriber_1=require("rxjs/OuterSubscriber");function bufferToggle(a,c){return this.lift(new BufferToggleOperator(a,c))}exports.bufferToggle=bufferToggle;var BufferToggleOperator=function(){function a(c,e){this.openings=c,this.closingSelector=e}return a.prototype.call=function(c,e){return e._subscribe(new BufferToggleSubscriber(c,this.openings,this.closingSelector))},a}(),BufferToggleSubscriber=function(a){function c(e,f,g){a.call(this,e),this.openings=f,this.closingSelector=g,this.contexts=[],this.add(subscribeToResult_1.subscribeToResult(this,f))}return __extends(c,a),c.prototype._next=function(e){for(var f=this.contexts,g=f.length,h=0;h<g;h++)f[h].buffer.push(e)},c.prototype._error=function(e){for(var g,f=this.contexts;0<f.length;)g=f.shift(),g.subscription.unsubscribe(),g.buffer=null,g.subscription=null;this.contexts=null,a.prototype._error.call(this,e)},c.prototype._complete=function(){for(var f,e=this.contexts;0<e.length;)f=e.shift(),this.destination.next(f.buffer),f.subscription.unsubscribe(),f.buffer=null,f.subscription=null;this.contexts=null,a.prototype._complete.call(this)},c.prototype.notifyNext=function(e,f){e?this.closeBuffer(e):this.openBuffer(f)},c.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},c.prototype.openBuffer=function(e){try{var f=this.closingSelector,g=f.call(this,e);g&&this.trySubscribe(g)}catch(h){this._error(h)}},c.prototype.closeBuffer=function(e){var f=this.contexts;if(f&&e){var g=e.buffer,h=e.subscription;this.destination.next(g),f.splice(f.indexOf(e),1),this.remove(h),h.unsubscribe()}},c.prototype.trySubscribe=function(e){var f=this.contexts,h=new Subscription_1.Subscription,j={buffer:[],subscription:h};f.push(j);var k=subscribeToResult_1.subscribeToResult(this,e,j);!k||k.closed?this.closeBuffer(j):(k.context=j,this.add(k),h.add(k))},c}(OuterSubscriber_1.OuterSubscriber);