'use strict';var __extends=this&&this.__extends||function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},Subscription_1=require('../Subscription'),tryCatch_1=require('../util/tryCatch'),errorObject_1=require('../util/errorObject'),OuterSubscriber_1=require('../OuterSubscriber'),subscribeToResult_1=require('../util/subscribeToResult');function bufferWhen(a){return this.lift(new BufferWhenOperator(a))}exports.bufferWhen=bufferWhen;var BufferWhenOperator=function(){function a(c){this.closingSelector=c}return a.prototype.call=function(c,e){return e._subscribe(new BufferWhenSubscriber(c,this.closingSelector))},a}(),BufferWhenSubscriber=function(a){function c(e,f){a.call(this,e),this.closingSelector=f,this.subscribing=!1,this.openBuffer()}return __extends(c,a),c.prototype._next=function(e){this.buffer.push(e)},c.prototype._complete=function(){var e=this.buffer;e&&this.destination.next(e),a.prototype._complete.call(this)},c.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},c.prototype.notifyNext=function(){this.openBuffer()},c.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},c.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var f=this.buffer;this.buffer&&this.destination.next(f),this.buffer=[];var g=tryCatch_1.tryCatch(this.closingSelector)();g===errorObject_1.errorObject?this.error(errorObject_1.errorObject.e):(e=new Subscription_1.Subscription,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(subscribeToResult_1.subscribeToResult(this,g)),this.subscribing=!1)},c}(OuterSubscriber_1.OuterSubscriber);