'use strict';var __extends=this&&this.__extends||function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},async_1=require('../scheduler/async'),isDate_1=require('../util/isDate'),Subscriber_1=require('../Subscriber'),Notification_1=require('../Notification');function delay(a,c){void 0===c&&(c=async_1.async);var e=isDate_1.isDate(a),f=e?+a-c.now():Math.abs(a);return this.lift(new DelayOperator(f,c))}exports.delay=delay;var DelayOperator=function(){function a(c,e){this.delay=c,this.scheduler=e}return a.prototype.call=function(c,e){return e._subscribe(new DelaySubscriber(c,this.delay,this.scheduler))},a}(),DelaySubscriber=function(a){function c(e,f,g){a.call(this,e),this.delay=f,this.scheduler=g,this.queue=[],this.active=!1,this.errored=!1}return __extends(c,a),c.dispatch=function(e){for(var f=e.source,g=f.queue,h=e.scheduler,i=e.destination;0<g.length&&0>=g[0].time-h.now();)g.shift().notification.observe(i);if(0<g.length){var j=Math.max(0,g[0].time-h.now());this.schedule(e,j)}else f.active=!1},c.prototype._schedule=function(e){this.active=!0,this.add(e.schedule(c.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},c.prototype.scheduleNotification=function(e){if(!0!==this.errored){var f=this.scheduler,g=new DelayMessage(f.now()+this.delay,e);this.queue.push(g),!1===this.active&&this._schedule(f)}},c.prototype._next=function(e){this.scheduleNotification(Notification_1.Notification.createNext(e))},c.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e)},c.prototype._complete=function(){this.scheduleNotification(Notification_1.Notification.createComplete())},c}(Subscriber_1.Subscriber),DelayMessage=function(){return function(c,e){this.time=c,this.notification=e}}();