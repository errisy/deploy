'use strict';var __extends=this&&this.__extends||function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},Subscriber_1=require('../Subscriber'),Observable_1=require('../Observable'),OuterSubscriber_1=require('../OuterSubscriber'),subscribeToResult_1=require('../util/subscribeToResult');function delayWhen(a,c){return c?new SubscriptionDelayObservable(this,c).lift(new DelayWhenOperator(a)):this.lift(new DelayWhenOperator(a))}exports.delayWhen=delayWhen;var DelayWhenOperator=function(){function a(c){this.delayDurationSelector=c}return a.prototype.call=function(c,e){return e._subscribe(new DelayWhenSubscriber(c,this.delayDurationSelector))},a}(),DelayWhenSubscriber=function(a){function c(e,f){a.call(this,e),this.delayDurationSelector=f,this.completed=!1,this.delayNotifierSubscriptions=[],this.values=[]}return __extends(c,a),c.prototype.notifyNext=function(e,f,g,h,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},c.prototype.notifyError=function(e){this._error(e)},c.prototype.notifyComplete=function(e){var f=this.removeSubscription(e);f&&this.destination.next(f),this.tryComplete()},c.prototype._next=function(e){try{var f=this.delayDurationSelector(e);f&&this.tryDelay(f,e)}catch(g){this.destination.error(g)}},c.prototype._complete=function(){this.completed=!0,this.tryComplete()},c.prototype.removeSubscription=function(e){e.unsubscribe();var f=this.delayNotifierSubscriptions.indexOf(e),g=null;return-1!==f&&(g=this.values[f],this.delayNotifierSubscriptions.splice(f,1),this.values.splice(f,1)),g},c.prototype.tryDelay=function(e,f){var g=subscribeToResult_1.subscribeToResult(this,e,f);this.add(g),this.delayNotifierSubscriptions.push(g),this.values.push(f)},c.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},c}(OuterSubscriber_1.OuterSubscriber),SubscriptionDelayObservable=function(a){function c(e,f){a.call(this),this.source=e,this.subscriptionDelay=f}return __extends(c,a),c.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new SubscriptionDelaySubscriber(e,this.source))},c}(Observable_1.Observable),SubscriptionDelaySubscriber=function(a){function c(e,f){a.call(this),this.parent=e,this.source=f,this.sourceSubscribed=!1}return __extends(c,a),c.prototype._next=function(){this.subscribeToSource()},c.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},c.prototype._complete=function(){this.subscribeToSource()},c.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},c}(Subscriber_1.Subscriber);