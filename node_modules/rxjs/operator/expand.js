"use strict";var __extends=function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},tryCatch_1=require("rxjs/util/tryCatch"),errorObject_1=require("rxjs/util/errorObject"),OuterSubscriber_1=require("rxjs/OuterSubscriber"),subscribeToResult_1=require("rxjs/util/subscribeToResult");function expand(a,c,e){return void 0===c&&(c=Number.POSITIVE_INFINITY),void 0===e&&(e=void 0),c=1>(c||0)?Number.POSITIVE_INFINITY:c,this.lift(new ExpandOperator(a,c,e))}exports.expand=expand;var ExpandOperator=function(){function a(c,e,f){this.project=c,this.concurrent=e,this.scheduler=f}return a.prototype.call=function(c,e){return e._subscribe(new ExpandSubscriber(c,this.project,this.concurrent,this.scheduler))},a}();exports.ExpandOperator=ExpandOperator;var ExpandSubscriber=function(a){function c(e,f,g,h){a.call(this,e),this.project=f,this.concurrent=g,this.scheduler=h,this.index=0,this.active=0,this.hasCompleted=!1,g<Number.POSITIVE_INFINITY&&(this.buffer=[])}return __extends(c,a),c.dispatch=function(e){var f=e.subscriber,g=e.result,h=e.value,i=e.index;f.subscribeToProjection(g,h,i)},c.prototype._next=function(e){var f=this.destination;if(f.closed)return void this._complete();var g=this.index++;if(this.active<this.concurrent){f.next(e);var h=tryCatch_1.tryCatch(this.project)(e,g);if(h===errorObject_1.errorObject)f.error(errorObject_1.errorObject.e);else if(!this.scheduler)this.subscribeToProjection(h,e,g);else{var i={subscriber:this,result:h,value:e,index:g};this.add(this.scheduler.schedule(c.dispatch,0,i))}}else this.buffer.push(e)},c.prototype.subscribeToProjection=function(e,f,g){this.active++,this.add(subscribeToResult_1.subscribeToResult(this,e,f,g))},c.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()},c.prototype.notifyNext=function(e,f){this._next(f)},c.prototype.notifyComplete=function(e){var f=this.buffer;this.remove(e),this.active--,f&&0<f.length&&this._next(f.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},c}(OuterSubscriber_1.OuterSubscriber);exports.ExpandSubscriber=ExpandSubscriber;