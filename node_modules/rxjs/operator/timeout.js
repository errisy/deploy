'use strict';var __extends=this&&this.__extends||function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},async_1=require('../scheduler/async'),isDate_1=require('../util/isDate'),Subscriber_1=require('../Subscriber');function timeout(a,c,e){void 0===c&&(c=null),void 0===e&&(e=async_1.async);var f=isDate_1.isDate(a),g=f?+a-e.now():Math.abs(a);return this.lift(new TimeoutOperator(g,f,c,e))}exports.timeout=timeout;var TimeoutOperator=function(){function a(c,e,f,g){this.waitFor=c,this.absoluteTimeout=e,this.errorToSend=f,this.scheduler=g}return a.prototype.call=function(c,e){return e._subscribe(new TimeoutSubscriber(c,this.absoluteTimeout,this.waitFor,this.errorToSend,this.scheduler))},a}(),TimeoutSubscriber=function(a){function c(e,f,g,h,i){a.call(this,e),this.absoluteTimeout=f,this.waitFor=g,this.errorToSend=h,this.scheduler=i,this.index=0,this._previousIndex=0,this._hasCompleted=!1,this.scheduleTimeout()}return __extends(c,a),Object.defineProperty(c.prototype,'previousIndex',{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,'hasCompleted',{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0}),c.dispatchTimeout=function(e){var f=e.subscriber,g=e.index;f.hasCompleted||f.previousIndex!==g||f.notifyTimeout()},c.prototype.scheduleTimeout=function(){var e=this.index;this.scheduler.schedule(c.dispatchTimeout,this.waitFor,{subscriber:this,index:e}),this.index++,this._previousIndex=e},c.prototype._next=function(e){this.destination.next(e),this.absoluteTimeout||this.scheduleTimeout()},c.prototype._error=function(e){this.destination.error(e),this._hasCompleted=!0},c.prototype._complete=function(){this.destination.complete(),this._hasCompleted=!0},c.prototype.notifyTimeout=function(){this.error(this.errorToSend||new Error('timeout'))},c}(Subscriber_1.Subscriber);