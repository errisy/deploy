"use strict";var __extends=function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},async_1=require("rxjs/scheduler/async"),isDate_1=require("rxjs/util/isDate"),OuterSubscriber_1=require("rxjs/OuterSubscriber"),subscribeToResult_1=require("rxjs/util/subscribeToResult");function timeoutWith(a,c,e){void 0===e&&(e=async_1.async);var f=isDate_1.isDate(a),g=f?+a-e.now():Math.abs(a);return this.lift(new TimeoutWithOperator(g,f,c,e))}exports.timeoutWith=timeoutWith;var TimeoutWithOperator=function(){function a(c,e,f,g){this.waitFor=c,this.absoluteTimeout=e,this.withObservable=f,this.scheduler=g}return a.prototype.call=function(c,e){return e._subscribe(new TimeoutWithSubscriber(c,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},a}(),TimeoutWithSubscriber=function(a){function c(e,f,g,h,i){a.call(this),this.destination=e,this.absoluteTimeout=f,this.waitFor=g,this.withObservable=h,this.scheduler=i,this.timeoutSubscription=void 0,this.index=0,this._previousIndex=0,this._hasCompleted=!1,e.add(this),this.scheduleTimeout()}return __extends(c,a),Object.defineProperty(c.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0}),c.dispatchTimeout=function(e){var f=e.subscriber,g=e.index;f.hasCompleted||f.previousIndex!==g||f.handleTimeout()},c.prototype.scheduleTimeout=function(){var e=this.index,f={subscriber:this,index:e};this.scheduler.schedule(c.dispatchTimeout,this.waitFor,f),this.index++,this._previousIndex=e},c.prototype._next=function(e){this.destination.next(e),this.absoluteTimeout||this.scheduleTimeout()},c.prototype._error=function(e){this.destination.error(e),this._hasCompleted=!0},c.prototype._complete=function(){this.destination.complete(),this._hasCompleted=!0},c.prototype.handleTimeout=function(){if(!this.closed){var e=this.withObservable;this.unsubscribe(),this.destination.add(this.timeoutSubscription=subscribeToResult_1.subscribeToResult(this,e))}},c}(OuterSubscriber_1.OuterSubscriber);