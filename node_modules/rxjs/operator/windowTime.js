"use strict";var __extends=function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},Subject_1=require("rxjs/Subject"),async_1=require("rxjs/scheduler/async"),Subscriber_1=require("rxjs/Subscriber");function windowTime(a,c,e){return void 0===c&&(c=null),void 0===e&&(e=async_1.async),this.lift(new WindowTimeOperator(a,c,e))}exports.windowTime=windowTime;var WindowTimeOperator=function(){function a(c,e,f){this.windowTimeSpan=c,this.windowCreationInterval=e,this.scheduler=f}return a.prototype.call=function(c,e){return e._subscribe(new WindowTimeSubscriber(c,this.windowTimeSpan,this.windowCreationInterval,this.scheduler))},a}(),WindowTimeSubscriber=function(a){function c(e,f,g,h){if(a.call(this,e),this.destination=e,this.windowTimeSpan=f,this.windowCreationInterval=g,this.scheduler=h,this.windows=[],null!==g&&0<=g){var j=this.openWindow(),k={subscriber:this,window:j,context:null},l={windowTimeSpan:f,windowCreationInterval:g,subscriber:this,scheduler:h};this.add(h.schedule(dispatchWindowClose,f,k)),this.add(h.schedule(dispatchWindowCreation,g,l))}else{var m=this.openWindow(),n={subscriber:this,window:m,windowTimeSpan:f};this.add(h.schedule(dispatchWindowTimeSpanOnly,f,n))}}return __extends(c,a),c.prototype._next=function(e){for(var j,f=this.windows,g=f.length,h=0;h<g;h++)j=f[h],j.closed||j.next(e)},c.prototype._error=function(e){for(var f=this.windows;0<f.length;)f.shift().error(e);this.destination.error(e)},c.prototype._complete=function(){for(var f,e=this.windows;0<e.length;)f=e.shift(),f.closed||f.complete();this.destination.complete()},c.prototype.openWindow=function(){var e=new Subject_1.Subject;this.windows.push(e);var f=this.destination;return f.next(e),e},c.prototype.closeWindow=function(e){e.complete();var f=this.windows;f.splice(f.indexOf(e),1)},c}(Subscriber_1.Subscriber);function dispatchWindowTimeSpanOnly(a){var c=a.subscriber,e=a.windowTimeSpan,f=a.window;f&&f.complete(),a.window=c.openWindow(),this.schedule(a,e)}function dispatchWindowCreation(a){var c=a.windowTimeSpan,e=a.subscriber,f=a.scheduler,g=a.windowCreationInterval,h=e.openWindow(),j=this,k={action:j,subscription:null};k.subscription=f.schedule(dispatchWindowClose,c,{subscriber:e,window:h,context:k}),j.add(k.subscription),j.schedule(a,g)}function dispatchWindowClose(a){var c=a.subscriber,e=a.window,f=a.context;f&&f.action&&f.subscription&&f.action.remove(f.subscription),c.closeWindow(e)}