"use strict";var __extends=function(a,c){function e(){this.constructor=a}for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);a.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)},Subject_1=require("rxjs/Subject"),Subscription_1=require("rxjs/Subscription"),tryCatch_1=require("rxjs/util/tryCatch"),errorObject_1=require("rxjs/util/errorObject"),OuterSubscriber_1=require("rxjs/OuterSubscriber"),subscribeToResult_1=require("rxjs/util/subscribeToResult");function windowToggle(a,c){return this.lift(new WindowToggleOperator(a,c))}exports.windowToggle=windowToggle;var WindowToggleOperator=function(){function a(c,e){this.openings=c,this.closingSelector=e}return a.prototype.call=function(c,e){return e._subscribe(new WindowToggleSubscriber(c,this.openings,this.closingSelector))},a}(),WindowToggleSubscriber=function(a){function c(e,f,g){a.call(this,e),this.openings=f,this.closingSelector=g,this.contexts=[],this.add(this.openSubscription=subscribeToResult_1.subscribeToResult(this,f,f))}return __extends(c,a),c.prototype._next=function(e){var f=this.contexts;if(f)for(var g=f.length,h=0;h<g;h++)f[h].window.next(e)},c.prototype._error=function(e){var f=this.contexts;if(this.contexts=null,f)for(var j,g=f.length,h=-1;++h<g;)j=f[h],j.window.error(e),j.subscription.unsubscribe();a.prototype._error.call(this,e)},c.prototype._complete=function(){var e=this.contexts;if(this.contexts=null,e)for(var h,f=e.length,g=-1;++g<f;)h=e[g],h.window.complete(),h.subscription.unsubscribe();a.prototype._complete.call(this)},c.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var h,f=e.length,g=-1;++g<f;)h=e[g],h.window.unsubscribe(),h.subscription.unsubscribe()},c.prototype.notifyNext=function(e,f){if(e===this.openings){var k=this.closingSelector,l=tryCatch_1.tryCatch(k)(f);if(l===errorObject_1.errorObject)return this.error(errorObject_1.errorObject.e);var m=new Subject_1.Subject,n=new Subscription_1.Subscription,o={window:m,subscription:n};this.contexts.push(o);var q=subscribeToResult_1.subscribeToResult(this,l,o);q.closed?this.closeWindow(this.contexts.length-1):(q.context=o,n.add(q)),this.destination.next(m)}else this.closeWindow(this.contexts.indexOf(e))},c.prototype.notifyError=function(e){this.error(e)},c.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},c.prototype.closeWindow=function(e){if(-1!==e){var f=this.contexts,g=f[e],h=g.window,j=g.subscription;f.splice(e,1),h.complete(),j.unsubscribe()}},c}(OuterSubscriber_1.OuterSubscriber);