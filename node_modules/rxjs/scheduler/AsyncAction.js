'use strict';var __extends=this&&this.__extends||function(a,c){function f(){this.constructor=a}for(var g in c)c.hasOwnProperty(g)&&(a[g]=c[g]);a.prototype=null===c?Object.create(c):(f.prototype=c.prototype,new f)},root_1=require('../util/root'),Action_1=require('./Action'),AsyncAction=function(a){function c(f,g){a.call(this,f,g),this.scheduler=f,this.work=g,this.pending=!1}return __extends(c,a),c.prototype.schedule=function(f,g){if(void 0===g&&(g=0),this.closed)return this;this.state=f,this.pending=!0;var h=this.id,i=this.scheduler;return null!=h&&(this.id=this.recycleAsyncId(i,h,g)),this.delay=g,this.id=this.id||this.requestAsyncId(i,this.id,g),this},c.prototype.requestAsyncId=function(f,g,h){return void 0===h&&(h=0),root_1.root.setInterval(f.flush.bind(f,this),h)},c.prototype.recycleAsyncId=function(f,g,h){return void 0===h&&(h=0),null!==h&&this.delay===h?g:root_1.root.clearInterval(g)&&void 0||void 0},c.prototype.execute=function(f,g){if(this.closed)return new Error('executing a cancelled action');this.pending=!1;var h=this._execute(f,g);return h?h:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null)))},c.prototype._execute=function(f){var i,h=!1;try{this.work(f)}catch(j){h=!0,i=!!j&&j||new Error(j)}if(h)return this.unsubscribe(),i},c.prototype._unsubscribe=function(){var f=this.id,g=this.scheduler,h=g.actions,i=h.indexOf(this);this.work=null,this.delay=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&h.splice(i,1),null!=f&&(this.id=this.recycleAsyncId(g,f,null))},c}(Action_1.Action);exports.AsyncAction=AsyncAction;