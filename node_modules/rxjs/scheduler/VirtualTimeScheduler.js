'use strict';var __extends=this&&this.__extends||function(c,e){function f(){this.constructor=c}for(var g in e)e.hasOwnProperty(g)&&(c[g]=e[g]);c.prototype=null===e?Object.create(e):(f.prototype=e.prototype,new f)},AsyncAction_1=require('./AsyncAction'),AsyncScheduler_1=require('./AsyncScheduler'),VirtualTimeScheduler=function(c){function e(f,g){var h=this;void 0===f&&(f=VirtualAction),void 0===g&&(g=Number.POSITIVE_INFINITY),c.call(this,f,function(){return h.frame}),this.maxFrames=g,this.frame=0,this.index=-1}return __extends(e,c),e.prototype.flush=function(){for(var i,j,f=this,g=f.actions,h=f.maxFrames;(j=g.shift())&&(this.frame=j.delay)<=h&&!(i=j.execute(j.state,j.delay)););if(i){for(;j=g.shift();)j.unsubscribe();throw i}},e.frameTimeFactor=10,e}(AsyncScheduler_1.AsyncScheduler);exports.VirtualTimeScheduler=VirtualTimeScheduler;var VirtualAction=function(c){function e(f,g,h){void 0===h&&(h=f.index+=1),c.call(this,f,g),this.scheduler=f,this.work=g,this.index=h,this.index=f.index=h}return __extends(e,c),e.prototype.schedule=function(f,g){return void 0===g&&(g=0),this.id?this.add(new e(this.scheduler,this.work)).schedule(f,g):c.prototype.schedule.call(this,f,g)},e.prototype.requestAsyncId=function(f,g,h){void 0===h&&(h=0),this.delay=f.frame+h;var i=f.actions;return i.push(this),i.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(f,g,h){return void 0===h&&(h=0),void 0},e.sortActions=function(f,g){return f.delay===g.delay?f.index===g.index?0:f.index>g.index?1:-1:f.delay>g.delay?1:-1},e}(AsyncAction_1.AsyncAction);exports.VirtualAction=VirtualAction;